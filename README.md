# å­¦ä¹  Solidity å®Œæˆä¸€ä¸ª CryptoZombie æ¸¸æˆé¡¹ç›®

> æœ¬æ•™ç¨‹åªæ˜¯æŠŠ https://cryptozombies.io/zh ç½‘ç«™ä¸­çš„æ•™ç¨‹æ‘˜å½•ä¸‹æ¥ï¼Œç”¨äºå­¦ä¹ å›é¡¾ï¼Œå…·ä½“å®æ“è¯·åœ¨ç½‘ç«™ä¸Šå­¦ä¹ å®è·µï¼Œé…Œæƒ…å‚è€ƒã€‚



## 1. å¼€å§‹ä¸€ä¸ªä¸­çº§çš„æ™ºèƒ½åˆçº¦

ä½ è®¤ä¸ºä½ å¯ä»¥å½“ä¸€ä¸ªåˆæ ¼çš„ **CryptoZombie**, å—¯ï¼Ÿ

è¿™ä¸ªæ•™ç¨‹ä¼šæ•™ä½ å¦‚ä½•æ­å»ºä¸€ä¸ª**ä»¥å¤ªç½‘çš„æ¸¸æˆ**ã€‚

æ­¤è¯¾ç¨‹ä¸º Solidity åˆå­¦è€…è®¾è®¡ï¼Œéœ€è¦ä½ å¯¹å…¶ä»–çš„ç¨‹åºè¯­è¨€æœ‰æ‰€äº†è§£ï¼ˆå¦‚ JavaScript)ã€‚

### 1.1 æ­å»ºåƒµå°¸å·¥å‚

#### ç¬¬1ç«  æ¦‚è¿°

ç¬¬ä¸€è¯¾ä½ å°†åˆ›é€ ä¸€ä¸ª"åƒµå°¸å·¥å‚"ï¼Œ ç”¨å®ƒå»ºç«‹ä¸€æ”¯åƒµå°¸éƒ¨é˜Ÿã€‚

- æˆ‘ä»¬çš„å·¥å‚ä¼šæŠŠæˆ‘ä»¬éƒ¨é˜Ÿä¸­æ‰€æœ‰çš„åƒµå°¸ä¿å­˜åˆ°æ•°æ®åº“ä¸­
- å·¥å‚ä¼šæœ‰ä¸€ä¸ªå‡½æ•°èƒ½äº§ç”Ÿæ–°çš„åƒµå°¸
- æ¯ä¸ªåƒµå°¸ä¼šæœ‰ä¸€ä¸ªéšæœºçš„ç‹¬ä¸€æ— äºŒçš„é¢å­”

åœ¨åé¢çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¼šå¢åŠ åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œè®©åƒµå°¸èƒ½æ”»å‡»äººç±»æˆ–å…¶å®ƒåƒµå°¸! ä½†æ˜¯åœ¨å®ç°è¿™äº›å¥½ç©çš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦å®ç°åˆ›å»ºåƒµå°¸è¿™æ ·çš„åŸºæœ¬åŠŸèƒ½ã€‚

##### åƒµå°¸ DNA å¦‚ä½•è¿ä½œ

åƒµå°¸çš„é¢å­”å–å†³äºå®ƒçš„DNAã€‚å®ƒçš„DNAå¾ˆç®€å•ï¼Œç”±ä¸€ä¸ª16ä½çš„æ•´æ•°ç»„æˆï¼š

``` bash
8356281049284737
```

å¦‚åŒçœŸæ­£çš„DNA, è¿™ä¸ªæ•°å­—çš„ä¸åŒéƒ¨åˆ†ä¼šå¯¹åº”ä¸åŒçš„ç‰¹ç‚¹ã€‚ å‰2ä½ä»£è¡¨å¤´å‹ï¼Œç´§æ¥ç€çš„2ä½ä»£è¡¨çœ¼ç›ï¼Œç­‰ç­‰ã€‚

> *æ³¨: æœ¬æ•™ç¨‹æˆ‘ä»¬å°½é‡ç®€åŒ–ã€‚æˆ‘ä»¬çš„åƒµå°¸åªæœ‰7ç§å¤´å‹(è™½ç„¶2ä½æ•°å­—å…è®¸100ç§å¯èƒ½æ€§)ã€‚ä»¥åæˆ‘ä»¬ä¼šåŠ å…¥æ›´å¤šçš„å¤´å‹, å¦‚æœæˆ‘ä»¬æƒ³è®©åƒµå°¸æœ‰æ›´å¤šé€ å‹ã€‚*

ä¾‹å¦‚ï¼Œå‰ä¸¤ä½æ•°å­—æ˜¯ `83`ï¼Œ è®¡ç®—åƒµå°¸çš„å¤´å‹ï¼Œæˆ‘ä»¬åš`83 % 7 + 1` = 7 è¿ç®—ï¼Œ æ­¤åƒµå°¸å°†è¢«èµ‹äºˆç¬¬ä¸ƒç±»å¤´å‹ã€‚

åœ¨å³è¾¹é¡µé¢ï¼Œç§»åŠ¨å¤´åŸºå› `head gene` æ»‘å—åˆ°ç¬¬ä¸ƒä½ç½®(åœ£è¯å¸½)å¯è§`83`æ‰€å¯¹åº”çš„ç‰¹ç‚¹ã€‚

##### å®æˆ˜æ¼”ä¹ 

1. ç©ä¸€ä¸‹é¡µé¢å³ä¾§çš„æ»‘å—ã€‚æ£€éªŒä¸€ä¸‹ä¸åŒçš„æ•°å­—å¯¹åº”ä¸åŒçš„åƒµå°¸çš„é•¿ç›¸ã€‚

å¥½äº†ï¼Œè¿™å·²ç»è¶³å¤Ÿä½ ç©ä¸€ä¼šå„¿äº†ã€‚ å½“ä½ æƒ³ç»§ç»­çš„æ—¶å€™ï¼Œç‚¹å‡»ä¸‹é¢çš„"ä¸‹ä¸€ç« "ï¼Œè®©æˆ‘ä»¬æ¥é’»ç ” Solidity ï¼

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/04/28/20220428104132.png" align="center" style="width:500px" />



#### ç¬¬2ç«  åˆçº¦

ä»æœ€åŸºæœ¬çš„å¼€å§‹å…¥æ‰‹:

Solidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨**åˆçº¦**é‡Œé¢. ä¸€ä»½`åˆçº¦`å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹.

ä¸€ä»½åä¸º `HelloWorld` çš„ç©ºåˆçº¦å¦‚ä¸‹:

``` solidity
contract HelloWorld {

}
```

##### ç‰ˆæœ¬æŒ‡ä»¤

æ‰€æœ‰çš„ Solidity æºç éƒ½å¿…é¡»å† ä»¥ "version pragma" â€” æ ‡æ˜ Solidity ç¼–è¯‘å™¨çš„ç‰ˆæœ¬. ä»¥é¿å…å°†æ¥æ–°çš„ç¼–è¯‘å™¨å¯èƒ½ç ´åä½ çš„ä»£ç ã€‚

ä¾‹å¦‚: `pragma solidity ^0.4.19;` (å½“å‰ Solidity çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 0.4.19).

ç»¼ä¸Šæ‰€è¿°ï¼Œ ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„åˆçº¦ â€” æ¯æ¬¡å»ºç«‹ä¸€ä¸ªæ–°çš„é¡¹ç›®æ—¶çš„ç¬¬ä¸€æ®µä»£ç :

``` solidity
pragma solidity ^0.4.19;

contract HelloWorld {

}
```

##### å®æˆ˜æ¼”ä¹ 

ä¸ºäº†å»ºç«‹æˆ‘ä»¬çš„åƒµå°¸éƒ¨é˜Ÿï¼Œ è®©æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªåŸºç¡€åˆçº¦ï¼Œç§°ä¸º `ZombieFactory`ã€‚

1. åœ¨å³è¾¹çš„è¾“å…¥æ¡†é‡Œè¾“å…¥ `0.4.19`ï¼Œæˆ‘ä»¬çš„åˆçº¦åŸºäºè¿™ä¸ªç‰ˆæœ¬çš„ç¼–è¯‘å™¨ã€‚
2. å»ºç«‹ä¸€ä¸ªç©ºåˆçº¦ `ZombieFactory`ã€‚

ä¸€åˆ‡å®Œæ¯•ï¼Œä¸‹é¢ "ç­”æ¡ˆ" ï¼š

``` solidity
pragma solidity ^0.4.19; //1. è¿™é‡Œå†™ç‰ˆæœ¬æŒ‡ä»¤

//2. è¿™é‡Œå»ºç«‹æ™ºèƒ½åˆçº¦
contract ZombieFactory {
}
```



#### ç¬¬3ç«  çŠ¶æ€å˜é‡å’Œæ•´æ•°

çœŸæ£’ï¼æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„åˆçº¦åšäº†ä¸€ä¸ªå¤–å£³ï¼Œ ä¸‹é¢å­¦ä¹  Solidity ä¸­å¦‚ä½•ä½¿ç”¨å˜é‡ã€‚

##### çŠ¶æ€å˜é‡

***çŠ¶æ€å˜é‡*** æ˜¯è¢«æ°¸ä¹…åœ°ä¿å­˜åœ¨åˆçº¦ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬è¢«å†™å…¥ä»¥å¤ªå¸åŒºå—é“¾ä¸­. æƒ³è±¡æˆå†™å…¥ä¸€ä¸ªæ•°æ®åº“ã€‚

ä¾‹å­ï¼š

``` solidity
contract Example {
  // è¿™ä¸ªæ— ç¬¦å·æ•´æ•°å°†ä¼šæ°¸ä¹…çš„è¢«ä¿å­˜åœ¨åŒºå—é“¾ä¸­
  uint myUnsignedInteger = 100;
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰ `myUnsignedInteger` ä¸º `uint` ç±»å‹ï¼Œå¹¶èµ‹å€¼100ã€‚

##### æ— ç¬¦å·æ•´æ•° uint

`uint` æ— ç¬¦å·æ•°æ®ç±»å‹ï¼Œ æŒ‡**å…¶å€¼ä¸èƒ½æ˜¯è´Ÿæ•°**ï¼Œå¯¹äºæœ‰ç¬¦å·çš„æ•´æ•°å­˜åœ¨åä¸º `int` çš„æ•°æ®ç±»å‹ã€‚

> *æ³¨: Solidityä¸­ï¼Œ* `uint` *å®é™…ä¸Šæ˜¯* `uint256`*ä»£åè¯ï¼Œ ä¸€ä¸ª256ä½çš„æ— ç¬¦å·æ•´æ•°ã€‚ä½ ä¹Ÿå¯ä»¥å®šä¹‰ä½æ•°å°‘çš„uints â€”* `uint8`*ï¼Œ* `uint16`*ï¼Œ* `uint32`*ï¼Œ ç­‰â€¦â€¦ ä½†ä¸€èˆ¬æ¥è®²ä½ æ„¿æ„ä½¿ç”¨ç®€å•çš„* `uint`*ï¼Œ é™¤éåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿™æˆ‘ä»¬åé¢ä¼šè®²ã€‚*

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬çš„åƒµå°¸DNAå°†ç”±ä¸€ä¸ªåå…­ä½æ•°å­—ç»„æˆã€‚

å®šä¹‰ `dnaDigits` ä¸º `uint` æ•°æ®ç±»å‹, å¹¶èµ‹å€¼ `16`ã€‚

``` solidity
pragma solidity ^0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
}
```



#### ç¬¬4ç«  æ•°å­¦è¿ç®—

åœ¨ Solidity ä¸­ï¼Œæ•°å­¦è¿ç®—å¾ˆç›´è§‚æ˜äº†ï¼Œä¸å…¶å®ƒç¨‹åºè®¾è®¡è¯­è¨€ç›¸åŒ:

- åŠ æ³•: `x + y`
- å‡æ³•: `x - y`,
- ä¹˜æ³•: `x * y`
- é™¤æ³•: `x / y`
- å–æ¨¡ / æ±‚ä½™: `x % y` *(ä¾‹å¦‚, `13 % 5` ä½™ `3`, å› ä¸º13é™¤ä»¥5ï¼Œä½™3)*

Solidity è¿˜æ”¯æŒ ***ä¹˜æ–¹æ“ä½œ\*** (å¦‚ï¼šx çš„ yæ¬¡æ–¹ï¼‰ // ä¾‹å¦‚ï¼š 5 ** 2 = 25

```solidity
uint x = 5 ** 2; // equal to 5^2 = 25
```

##### å®æˆ˜æ¼”ä¹ 

ä¸ºäº†ä¿è¯æˆ‘ä»¬çš„åƒµå°¸çš„DNAåªå«æœ‰16ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å…ˆé€ ä¸€ä¸ª`uint`æ•°æ®ï¼Œè®©å®ƒç­‰äº10^16ã€‚è¿™æ ·ä¸€æ¥ä»¥åæˆ‘ä»¬å¯ä»¥ç”¨æ¨¡è¿ç®—ç¬¦ `%` æŠŠä¸€ä¸ªæ•´æ•°å˜æˆ16ä½ã€‚

1. å»ºç«‹ä¸€ä¸ª`uint`ç±»å‹çš„å˜é‡ï¼Œåå­—å«`dnaModulus`, ä»¤å…¶ç­‰äº **10 çš„ `dnaDigits` æ¬¡æ–¹**.

``` solidity
pragma solidity ^0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;
}
```



#### ç¬¬5ç«  ç»“æ„ä½“

æœ‰æ—¶ä½ éœ€è¦æ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼ŒSolidity æä¾›äº† **ç»“æ„ä½“**:

```solidity
struct Person {
  uint age;
  string name;
}
```

ç»“æ„ä½“å…è®¸ä½ ç”Ÿæˆä¸€ä¸ªæ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå®ƒæœ‰å¤šä¸ªå±æ€§ã€‚

> æ³¨ï¼šæˆ‘ä»¬åˆšåˆšå¼•è¿›äº†ä¸€ä¸ªæ–°ç±»å‹, `string`ã€‚ å­—ç¬¦ä¸²ç”¨äºä¿å­˜ä»»æ„é•¿åº¦çš„ UTF-8 ç¼–ç æ•°æ®ã€‚ å¦‚ï¼š `string greeting = "Hello world!"`ã€‚

##### å®æˆ˜æ¼”ä¹ 

åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€äº›åƒµå°¸ï¼æ¯ä¸ªåƒµå°¸å°†æ‹¥æœ‰å¤šä¸ªå±æ€§ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºç»“æ„ä½“çš„å®Œç¾ä¾‹å­ã€‚

1. å»ºç«‹ä¸€ä¸ª`struct` å‘½åä¸º `Zombie`.
2. æˆ‘ä»¬çš„ `Zombie` ç»“æ„ä½“æœ‰ä¸¤ä¸ªå±æ€§ï¼š `name` (ç±»å‹ä¸º `string`), å’Œ `dna` (ç±»å‹ä¸º `uint`)ã€‚

``` solidity
pragma solidity ^0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }
}
```



#### ç¬¬6ç«  æ•°ç»„

å¦‚æœä½ æƒ³å»ºç«‹ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥ç”¨ **_æ•°ç»„_**è¿™æ ·çš„æ•°æ®ç±»å‹. Solidity æ”¯æŒä¸¤ç§æ•°ç»„: **_é™æ€_** æ•°ç»„å’Œ**_åŠ¨æ€_** æ•°ç»„:

```solidity
// å›ºå®šé•¿åº¦ä¸º2çš„é™æ€æ•°ç»„:
uint[2] fixedArray;
// å›ºå®šé•¿åº¦ä¸º5çš„stringç±»å‹çš„é™æ€æ•°ç»„:
string[5] stringArray;
// åŠ¨æ€æ•°ç»„ï¼Œé•¿åº¦ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å…ƒç´ :
uint[] dynamicArray;
```

ä½ ä¹Ÿå¯ä»¥å»ºç«‹ä¸€ä¸ª ***ç»“æ„ä½“*** ç±»å‹çš„æ•°ç»„ ä¾‹å¦‚ï¼Œä¸Šä¸€ç« æåˆ°çš„ `Person`:

```solidity
Person[] people; // è¿™æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­æ·»åŠ å…ƒç´ 
```

è®°ä½ï¼šçŠ¶æ€å˜é‡è¢«æ°¸ä¹…ä¿å­˜åœ¨åŒºå—é“¾ä¸­ã€‚æ‰€ä»¥åœ¨ä½ çš„åˆçº¦ä¸­åˆ›å»ºåŠ¨æ€æ•°ç»„æ¥ä¿å­˜æˆç»“æ„çš„æ•°æ®æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚

##### å…¬å…±æ•°ç»„

ä½ å¯ä»¥å®šä¹‰ `public` æ•°ç»„, Solidity ä¼šè‡ªåŠ¨åˆ›å»º ***getter*** æ–¹æ³•. è¯­æ³•å¦‚ä¸‹:

```solidity
Person[] public people;
```

å…¶å®ƒçš„åˆçº¦å¯ä»¥ä»è¿™ä¸ªæ•°ç»„è¯»å–æ•°æ®ï¼ˆä½†ä¸èƒ½å†™å…¥æ•°æ®ï¼‰ï¼Œæ‰€ä»¥è¿™åœ¨åˆçº¦ä¸­æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ä¿å­˜å…¬å…±æ•°æ®çš„æ¨¡å¼ã€‚

##### å®æˆ˜æ¼”ä¹ 

ä¸ºäº†æŠŠä¸€ä¸ªåƒµå°¸éƒ¨é˜Ÿä¿å­˜åœ¨æˆ‘ä»¬çš„APPé‡Œï¼Œå¹¶ä¸”èƒ½å¤Ÿè®©å…¶å®ƒAPPçœ‹åˆ°è¿™äº›åƒµå°¸ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¬å…±æ•°ç»„ã€‚

1. åˆ›å»ºä¸€ä¸ªæ•°æ®ç±»å‹ä¸º `Zombie` çš„ç»“æ„ä½“æ•°ç»„ï¼Œç”¨ `public` ä¿®é¥°ï¼Œå‘½åä¸ºï¼š`zombies`.

``` solidity
pragma solidity ^0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;
}
```



#### ç¬¬7ç«  å®šä¹‰å‡½æ•°

åœ¨ Solidity ä¸­å‡½æ•°å®šä¹‰çš„å¥æ³•å¦‚ä¸‹:

```solidity
function eatHamburgers(string _name, uint _amount) {
}
```

è¿™æ˜¯ä¸€ä¸ªåä¸º `eatHamburgers` çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª `string`ç±»å‹çš„ å’Œ ä¸€ä¸ª `uint`ç±»å‹çš„ã€‚ç°åœ¨å‡½æ•°å†…éƒ¨è¿˜æ˜¯ç©ºçš„ã€‚

> æ³¨ï¼š: ä¹ æƒ¯ä¸Šå‡½æ•°é‡Œçš„å˜é‡éƒ½æ˜¯ä»¥(`_`)å¼€å¤´ (ä½†ä¸æ˜¯ç¡¬æ€§è§„å®š) ä»¥åŒºåˆ«å…¨å±€å˜é‡ã€‚æˆ‘ä»¬æ•´ä¸ªæ•™ç¨‹éƒ½ä¼šæ²¿ç”¨è¿™ä¸ªä¹ æƒ¯ã€‚

æˆ‘ä»¬çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹:

```solidity
eatHamburgers("vitalik", 100);
```

##### å®æˆ˜æ¼”ä¹ 

åœ¨æˆ‘ä»¬çš„åº”ç”¨é‡Œï¼Œæˆ‘ä»¬è¦èƒ½åˆ›å»ºä¸€äº›åƒµå°¸ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°åšè¿™ä»¶äº‹å§ï¼

1. å»ºç«‹ä¸€ä¸ªå‡½æ•° `createZombie`ã€‚ å®ƒæœ‰ä¸¤ä¸ªå‚æ•°: **_name** (ç±»å‹ä¸º`string`), å’Œ **_dna** (ç±»å‹ä¸º`uint`)ã€‚

æš‚æ—¶è®©å‡½æ•°ç©ºç€â€”â€”æˆ‘ä»¬åœ¨åé¢ä¼šå¢åŠ å†…å®¹ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function createZombie(string calldata _name, uint _dna) public {
    }
}
```



#### ç¬¬8ç«  ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„

##### åˆ›å»ºæ–°çš„ç»“æ„ä½“

è¿˜è®°å¾—ä¸Šä¸ªä¾‹å­ä¸­çš„ `Person` ç»“æ„å—ï¼Ÿ

```solidity
struct Person {
  uint age;
  string name;
}

Person[] public people;
```

ç°åœ¨æˆ‘ä»¬å­¦ä¹ åˆ›å»ºæ–°çš„ `Person` ç»“æ„ï¼Œç„¶åæŠŠå®ƒåŠ å…¥åˆ°åä¸º `people` çš„æ•°ç»„ä¸­.

```solidity
// åˆ›å»ºä¸€ä¸ªæ–°çš„Person:
Person satoshi = Person(172, "Satoshi");

// å°†æ–°åˆ›å»ºçš„satoshiæ·»åŠ è¿›peopleæ•°ç»„:
people.push(satoshi);
```

ä½ ä¹Ÿå¯ä»¥ä¸¤æ­¥å¹¶ä¸€æ­¥ï¼Œç”¨ä¸€è¡Œä»£ç æ›´ç®€æ´:

```solidity
people.push(Person(16, "Vitalik"));
```

> æ³¨ï¼š`array.push()` åœ¨æ•°ç»„çš„ **å°¾éƒ¨** åŠ å…¥æ–°å…ƒç´  ï¼Œæ‰€ä»¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°±æ˜¯æˆ‘ä»¬æ·»åŠ çš„é¡ºåºï¼Œ å¦‚:

```solidity
uint[] numbers;
numbers.push(5);
numbers.push(10);
numbers.push(15);
// numbers is now equal to [5, 10, 15]
```

##### å®æˆ˜æ¼”ä¹ 

è®©æˆ‘ä»¬åˆ›å»ºåä¸ºcreateZombieçš„å‡½æ•°æ¥åšç‚¹å„¿ä»€ä¹ˆå§ã€‚

1. åœ¨å‡½æ•°ä½“é‡Œæ–°åˆ›å»ºä¸€ä¸ª `Zombie`ï¼Œ ç„¶åæŠŠå®ƒåŠ å…¥ `zombies` æ•°ç»„ä¸­ã€‚ æ–°åˆ›å»ºçš„åƒµå°¸çš„ `name` å’Œ `dna`ï¼Œæ¥è‡ªäºå‡½æ•°çš„å‚æ•°ã€‚
2. è®©æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç ç®€æ´åœ°å®Œæˆå®ƒã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function createZombie(string calldata _name, uint _dna) public {
        zombies.push(Zombie(_name, _dna));
    }
}
```



#### ç¬¬9ç«  ç§æœ‰ / å…¬å…±å‡½æ•°

Solidity å®šä¹‰çš„å‡½æ•°çš„å±æ€§é»˜è®¤ä¸º`å…¬å…±`ã€‚ è¿™å°±æ„å‘³ç€ä»»ä½•ä¸€æ–¹ (æˆ–å…¶å®ƒåˆçº¦) éƒ½å¯ä»¥è°ƒç”¨ä½ åˆçº¦é‡Œçš„å‡½æ•°ã€‚

æ˜¾ç„¶ï¼Œä¸æ˜¯ä»€ä¹ˆæ—¶å€™éƒ½éœ€è¦è¿™æ ·ï¼Œè€Œä¸”è¿™æ ·çš„åˆçº¦æ˜“äºå—åˆ°æ”»å‡»ã€‚ æ‰€ä»¥å°†è‡ªå·±çš„å‡½æ•°å®šä¹‰ä¸º`ç§æœ‰`æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œåªæœ‰å½“ä½ éœ€è¦å¤–éƒ¨ä¸–ç•Œè°ƒç”¨å®ƒæ—¶æ‰å°†å®ƒè®¾ç½®ä¸º`å…¬å…±`ã€‚

å¦‚ä½•å®šä¹‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°å‘¢ï¼Ÿ

```solidity
uint[] numbers;

function _addToArray(uint _number) private {
  numbers.push(_number);
}
```

è¿™æ„å‘³ç€åªæœ‰æˆ‘ä»¬åˆçº¦ä¸­çš„å…¶å®ƒå‡½æ•°æ‰èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç»™ `numbers` æ•°ç»„æ·»åŠ æ–°æˆå‘˜ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å‡½æ•°åå­—åé¢ä½¿ç”¨å…³é”®å­— `private` å³å¯ã€‚å’Œå‡½æ•°çš„å‚æ•°ç±»ä¼¼ï¼Œç§æœ‰å‡½æ•°çš„åå­—ç”¨(`_`)èµ·å§‹ã€‚

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬åˆçº¦çš„å‡½æ•° `createZombie` çš„é»˜è®¤å±æ€§æ˜¯å…¬å…±çš„ï¼Œè¿™æ„å‘³ç€ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥è°ƒç”¨å®ƒå»åˆ›å»ºä¸€ä¸ªåƒµå°¸ã€‚ å’±ä»¬æ¥æŠŠå®ƒå˜æˆç§æœ‰å§ï¼

1. å˜ `createZombie` ä¸ºç§æœ‰å‡½æ•°ï¼Œä¸è¦å¿˜è®°éµå®ˆå‘½åçš„è§„çŸ©å“¦ï¼

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string calldata _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
    }
}
```



#### ç¬¬10ç«  å‡½æ•°çš„æ›´å¤šå±æ€§

æœ¬ç« ä¸­æˆ‘ä»¬å°†å­¦ä¹ å‡½æ•°çš„è¿”å›å€¼å’Œä¿®é¥°ç¬¦ã€‚

##### è¿”å›å€¼

è¦æƒ³å‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼ï¼ŒæŒ‰å¦‚ä¸‹å®šä¹‰ï¼š

```solidity
string greeting = "What's up dog";

function sayHello() public returns (string) {
  return greeting;
}
```

Solidity é‡Œï¼Œå‡½æ•°çš„å®šä¹‰é‡Œå¯åŒ…å«è¿”å›å€¼çš„æ•°æ®ç±»å‹(å¦‚æœ¬ä¾‹ä¸­ `string`)ã€‚

##### å‡½æ•°çš„ä¿®é¥°ç¬¦

ä¸Šé¢çš„å‡½æ•°å®é™…ä¸Šæ²¡æœ‰æ”¹å˜ Solidity é‡Œçš„çŠ¶æ€ï¼Œå³ï¼Œå®ƒæ²¡æœ‰æ”¹å˜ä»»ä½•å€¼æˆ–è€…å†™ä»»ä½•ä¸œè¥¿ã€‚

è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°å®šä¹‰ä¸º ***view***, æ„å‘³ç€å®ƒåªèƒ½è¯»å–æ•°æ®ä¸èƒ½æ›´æ”¹æ•°æ®:

```solidity
function sayHello() public view returns (string) {
```

Solidity è¿˜æ”¯æŒ ***pure*** å‡½æ•°, è¡¨æ˜è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è®¿é—®åº”ç”¨é‡Œçš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š

```solidity
function _multiply(uint a, uint b) private pure returns (uint) {
  return a * b;
}
```

è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è¯»å–åº”ç”¨é‡Œçš„çŠ¶æ€ â€” å®ƒçš„è¿”å›å€¼å®Œå…¨å–å†³äºå®ƒçš„è¾“å…¥å‚æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æŠŠå‡½æ•°å®šä¹‰ä¸º ***pure***.

> æ³¨ï¼šå¯èƒ½å¾ˆéš¾è®°ä½ä½•æ—¶æŠŠå‡½æ•°æ ‡è®°ä¸º pure/viewã€‚ å¹¸è¿çš„æ˜¯ï¼Œ Solidity ç¼–è¾‘å™¨ä¼šç»™å‡ºæç¤ºï¼Œæé†’ä½ ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ã€‚

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œå®ƒæ ¹æ®ä¸€ä¸ªå­—ç¬¦ä¸²éšæœºç”Ÿæˆä¸€ä¸ªDNAæ•°æ®ã€‚

1. åˆ›å»ºä¸€ä¸ª `private` å‡½æ•°ï¼Œå‘½åä¸º `_generateRandomDna`ã€‚å®ƒåªæ¥æ”¶ä¸€ä¸ªè¾“å…¥å˜é‡ `_str` (ç±»å‹ `string`), è¿”å›ä¸€ä¸ª `uint` ç±»å‹çš„æ•°å€¼ã€‚
2. æ­¤å‡½æ•°åªè¯»å–æˆ‘ä»¬åˆçº¦ä¸­çš„ä¸€äº›å˜é‡ï¼Œæ‰€ä»¥æ ‡è®°ä¸º`view`ã€‚
3. å‡½æ•°å†…éƒ¨æš‚æ—¶ç•™ç©ºï¼Œä»¥åæˆ‘ä»¬å†æ·»åŠ ä»£ç ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >=0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string calldata _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
    }

    function _generateRandomDna(string calldata _str) private view returns (uint) {

    }
}
```



#### ç¬¬11ç«  Keccak256 å’Œ ç±»å‹è½¬æ¢

å¦‚ä½•è®© `_generateRandomDna` å‡½æ•°è¿”å›ä¸€ä¸ªå…¨(åŠ) éšæœºçš„ `uint`?

Ethereum å†…éƒ¨æœ‰ä¸€ä¸ªæ•£åˆ—å‡½æ•°`keccak256`ï¼Œå®ƒç”¨äº†SHA3ç‰ˆæœ¬ã€‚ä¸€ä¸ªæ•£åˆ—å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª256ä½çš„16è¿›åˆ¶æ•°å­—ã€‚å­—ç¬¦ä¸²çš„ä¸€ä¸ªå¾®å°å˜åŒ–ä¼šå¼•èµ·æ•£åˆ—æ•°æ®æå¤§å˜åŒ–ã€‚

è¿™åœ¨ Ethereum ä¸­æœ‰å¾ˆå¤šåº”ç”¨ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åªæ˜¯ç”¨å®ƒé€ ä¸€ä¸ªä¼ªéšæœºæ•°ã€‚

ä¾‹å­:

```bash
//6e91ec6b618bb462a4a6ee5aa2cb0e9cf30f7a052bb467b0ba58b8748c00d2e5
keccak256("aaaab");
//b1f078126895a1424524de5321b339ab00408010b7cf0e6ed451514981e58aa9
keccak256("aaaac");
```

æ˜¾è€Œæ˜“è§ï¼Œè¾“å…¥å­—ç¬¦ä¸²åªæ”¹å˜äº†ä¸€ä¸ªå­—æ¯ï¼Œè¾“å‡ºå°±å·²ç»å¤©å£¤ä¹‹åˆ«äº†ã€‚

> æ³¨: åœ¨åŒºå—é“¾ä¸­**å®‰å…¨åœ°**äº§ç”Ÿä¸€ä¸ªéšæœºæ•°æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼Œ æœ¬ä¾‹çš„æ–¹æ³•ä¸å®‰å…¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„Zombie DNAç®—æ³•é‡Œä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œå·²ç»å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦äº†ã€‚

##### ç±»å‹è½¬æ¢

æœ‰æ—¶ä½ éœ€è¦å˜æ¢æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚:

```solidity
uint8 a = 5;
uint b = 6;
// å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º a * b è¿”å› uint, è€Œä¸æ˜¯ uint8:
uint8 c = a * b;
// æˆ‘ä»¬éœ€è¦å°† b è½¬æ¢ä¸º uint8:
uint8 c = a * uint8(b);
```

ä¸Šé¢, `a * b` è¿”å›ç±»å‹æ˜¯ `uint`, ä½†æ˜¯å½“æˆ‘ä»¬å°è¯•ç”¨ `uint8` ç±»å‹æ¥æ”¶æ—¶, å°±ä¼šé€ æˆæ½œåœ¨çš„é”™è¯¯ã€‚å¦‚æœæŠŠå®ƒçš„æ•°æ®ç±»å‹è½¬æ¢ä¸º `uint8`, å°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šå‡ºé”™ã€‚

##### å®æˆ˜æ¼”ä¹ 

ç»™ `_generateRandomDna` å‡½æ•°æ·»åŠ ä»£ç ! å®ƒåº”è¯¥å®Œæˆå¦‚ä¸‹åŠŸèƒ½:

1. ç¬¬ä¸€è¡Œä»£ç å– `_str` çš„ `keccak256` æ•£åˆ—å€¼ç”Ÿæˆä¸€ä¸ªä¼ªéšæœºåå…­è¿›åˆ¶æ•°ï¼Œç±»å‹è½¬æ¢ä¸º `uint`, æœ€åä¿å­˜åœ¨ç±»å‹ä¸º `uint` åä¸º `rand` çš„å˜é‡ä¸­ã€‚
2. æˆ‘ä»¬åªæƒ³è®©æˆ‘ä»¬çš„DNAçš„é•¿åº¦ä¸º16ä½ (è¿˜è®°å¾— `dnaModulus`?)ã€‚æ‰€ä»¥ç¬¬äºŒè¡Œä»£ç åº”è¯¥ `return` ä¸Šé¢è®¡ç®—çš„æ•°å€¼å¯¹ `dnaModulus` æ±‚ä½™æ•°(`%`)ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string calldata _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
    }

    function _generateRandomDna(string calldata _str) private view returns (uint) {
        uint rand = uint(keccak256(abi.encode(_str)));
        return rand % dnaModulus;
    }
}
```



#### ç¬¬12ç«  æ”¾åœ¨ä¸€èµ·

æˆ‘ä»¬å°±å¿«å®Œæˆæˆ‘ä»¬çš„éšæœºåƒµå°¸åˆ¶é€ å™¨äº†ï¼Œæ¥å†™ä¸€ä¸ªå…¬å…±çš„å‡½æ•°æŠŠæ‰€æœ‰çš„éƒ¨ä»¶è¿æ¥èµ·æ¥ã€‚

å†™ä¸€ä¸ªå…¬å…±å‡½æ•°ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æ¥æ”¶åƒµå°¸çš„åå­—ï¼Œä¹‹åç”¨å®ƒç”Ÿæˆåƒµå°¸çš„DNAã€‚

##### å®æˆ˜æ¼”ä¹ 

1. åˆ›å»ºä¸€ä¸ª `public` å‡½æ•°ï¼Œå‘½åä¸º `createRandomZombie`. å®ƒå°†è¢«ä¼ å…¥ä¸€ä¸ªå˜é‡ `_name` (æ•°æ®ç±»å‹æ˜¯ `string`)ã€‚ *(æ³¨: å®šä¹‰å…¬å…±å‡½æ•° `public` å’Œå®šä¹‰ä¸€ä¸ªç§æœ‰ `private` å‡½æ•°çš„åšæ³•ä¸€æ ·)*ã€‚
2. å‡½æ•°çš„ç¬¬ä¸€è¡Œåº”è¯¥è°ƒç”¨ `_generateRandomDna` å‡½æ•°ï¼Œä¼ å…¥ `_name` å‚æ•°, ç»“æœä¿å­˜åœ¨ä¸€ä¸ªç±»å‹ä¸º `uint` çš„å˜é‡é‡Œï¼Œå‘½åä¸º `randDna`ã€‚
3. ç¬¬äºŒè¡Œè°ƒç”¨ `_createZombie` å‡½æ•°ï¼Œ ä¼ å…¥å‚æ•°ï¼š `_name` å’Œ `randDna`ã€‚
4. æ•´ä¸ªå‡½æ•°åº”è¯¥æ˜¯4è¡Œä»£ç  (åŒ…æ‹¬å‡½æ•°çš„ç»“æŸç¬¦å· `}` )ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string calldata _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
    }

    function _generateRandomDna(string calldata _str) private view returns (uint) {
        uint rand = uint(keccak256(abi.encode(_str)));
        return rand % dnaModulus;
    }

    function createRandomZombie(string calldata _name) public {
        uint randDna = _generateRandomDna(_name);
        _createZombie(_name, randDna);
    }
}
```



#### ç¬¬13ç«  äº‹ä»¶

æˆ‘ä»¬çš„åˆçº¦å‡ ä¹å°±è¦å®Œæˆäº†ï¼è®©æˆ‘ä»¬åŠ ä¸Šä¸€ä¸ª**äº‹ä»¶**.

**äº‹ä»¶** æ˜¯åˆçº¦å’ŒåŒºå—é“¾é€šè®¯çš„ä¸€ç§æœºåˆ¶ã€‚ä½ çš„å‰ç«¯åº”ç”¨â€œç›‘å¬â€æŸäº›äº‹ä»¶ï¼Œå¹¶åšå‡ºååº”ã€‚

ä¾‹å­:

```solidity
// è¿™é‡Œå»ºç«‹äº‹ä»¶
event IntegersAdded(uint x, uint y, uint result);

function add(uint _x, uint _y) public {
  uint result = _x + _y;
  //è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥app
  IntegersAdded(_x, _y, result);
  return result;
}
```

ä½ çš„ app å‰ç«¯å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚JavaScript å®ç°å¦‚ä¸‹:

```solidity
YourContract.IntegersAdded(function(error, result) {
  // å¹²äº›äº‹
})
```

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬æƒ³æ¯å½“ä¸€ä¸ªåƒµå°¸åˆ›é€ å‡ºæ¥æ—¶ï¼Œæˆ‘ä»¬çš„å‰ç«¯éƒ½èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶å°†å®ƒæ˜¾ç¤ºå‡ºæ¥ã€‚

1. å®šä¹‰ä¸€ä¸ª `äº‹ä»¶` å«åš `NewZombie`ã€‚ å®ƒæœ‰3ä¸ªå‚æ•°: `zombieId` (`uint`)ï¼Œ `name` (`string`)ï¼Œ å’Œ `dna` (`uint`)ã€‚

2. ä¿®æ”¹ `_createZombie` å‡½æ•°ä½¿å¾—å½“æ–°åƒµå°¸é€ å‡ºæ¥å¹¶åŠ å…¥ `zombies`æ•°ç»„åï¼Œç”Ÿæˆäº‹ä»¶`NewZombie`ã€‚

3. éœ€è¦å®šä¹‰åƒµå°¸`id`ã€‚ `array.push()` è¿”å›æ•°ç»„çš„é•¿åº¦ç±»å‹æ˜¯`uint` - å› ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯ 0ï¼Œ `array.push() - 1` å°†æ˜¯æˆ‘ä»¬åŠ å…¥çš„åƒµå°¸çš„ç´¢å¼•ã€‚ `zombies.push() - 1` å°±æ˜¯ `id`ï¼Œæ•°æ®ç±»å‹æ˜¯ `uint`ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ä½ å¯ä»¥æŠŠå®ƒç”¨åˆ° `NewZombie` äº‹ä»¶ä¸­ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

contract ZombieFactory {

    // è¿™é‡Œå»ºç«‹äº‹ä»¶
    event NewZombie(uint zombieId, string name, uint dna);
    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string memory _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
        // è¿™é‡Œè§¦å‘äº‹ä»¶
        uint id = zombies.length -1;
        emit NewZombie(id, _name, _dna);
    }

    function _generateRandomDna(string memory _str) private view returns (uint) {
        uint rand = uint(keccak256(abi.encode(_str)));
        return rand % dnaModulus;
    }

    function createRandomZombie(string memory _name) public {
        uint randDna = _generateRandomDna(_name);
        _createZombie(_name, randDna);
    }
}
```



#### ç¬¬14ç«  Web3.js

æˆ‘ä»¬çš„ Solidity åˆçº¦å®Œå·¥äº†ï¼ ç°åœ¨æˆ‘ä»¬è¦å†™ä¸€æ®µ JavaScript å‰ç«¯ä»£ç æ¥è°ƒç”¨è¿™ä¸ªåˆçº¦ã€‚

ä»¥å¤ªåŠæœ‰ä¸€ä¸ª JavaScript åº“ï¼Œåä¸º ***Web3.js***ã€‚

åœ¨åé¢çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥åœ°æ•™ä½ å¦‚ä½•å®‰è£…ä¸€ä¸ªåˆçº¦ï¼Œå¦‚ä½•è®¾ç½®Web3.jsã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥äº†è§£ Web3.js æ˜¯å¦‚ä½•å’Œæˆ‘ä»¬å‘å¸ƒçš„åˆçº¦äº¤äº’çš„å§ã€‚

å¦‚æœä¸‹é¢çš„ä»£ç ä½ ä¸èƒ½å…¨éƒ½ç†è§£ï¼Œä¸ç”¨æ‹…å¿ƒã€‚

```javascript
// ä¸‹é¢æ˜¯è°ƒç”¨åˆçº¦çš„æ–¹å¼:
var abi = /* abiæ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ */
var ZombieFactoryContract = web3.eth.contract(abi)
var contractAddress = /* å‘å¸ƒä¹‹ååœ¨ä»¥å¤ªåŠä¸Šç”Ÿæˆçš„åˆçº¦åœ°å€ */
var ZombieFactory = ZombieFactoryContract.at(contractAddress)
// `ZombieFactory` èƒ½è®¿é—®å…¬å…±çš„å‡½æ•°ä»¥åŠäº‹ä»¶

// æŸä¸ªç›‘å¬æ–‡æœ¬è¾“å…¥çš„ç›‘å¬å™¨:
$("#ourButton").click(function(e) {
  var name = $("#nameInput").val()
  //è°ƒç”¨åˆçº¦çš„ `createRandomZombie` å‡½æ•°:
  ZombieFactory.createRandomZombie(name)
})

// ç›‘å¬ `NewZombie` äº‹ä»¶, å¹¶ä¸”æ›´æ–°UI
var event = ZombieFactory.NewZombie(function(error, result) {
  if (error) return
  generateZombie(result.zombieId, result.name, result.dna)
})

// è·å– Zombie çš„ dna, æ›´æ–°å›¾åƒ
function generateZombie(id, name, dna) {
  let dnaStr = String(dna)
  // å¦‚æœdnaå°‘äº16ä½,åœ¨å®ƒå‰é¢ç”¨0è¡¥ä¸Š
  while (dnaStr.length < 16)
    dnaStr = "0" + dnaStr

  let zombieDetails = {
    // å‰ä¸¤ä½æ•°æ„æˆå¤´éƒ¨.æˆ‘ä»¬å¯èƒ½æœ‰7ç§å¤´éƒ¨, æ‰€ä»¥ % 7
    // å¾—åˆ°çš„æ•°åœ¨0-6,å†åŠ ä¸Š1,æ•°çš„èŒƒå›´å˜æˆ1-7
    // é€šè¿‡è¿™æ ·è®¡ç®—ï¼š
    headChoice: dnaStr.substring(0, 2) % 7 + 1ï¼Œ
    // æˆ‘ä»¬å¾—åˆ°çš„å›¾ç‰‡åç§°ä»head1.png åˆ° head7.png

    // æ¥ä¸‹æ¥çš„ä¸¤ä½æ•°æ„æˆçœ¼ç›, çœ¼ç›å˜åŒ–å°±å¯¹11å–æ¨¡:
    eyeChoice: dnaStr.substring(2, 4) % 11 + 1,
    // å†æ¥ä¸‹æ¥çš„ä¸¤ä½æ•°æ„æˆè¡£æœï¼Œè¡£æœå˜åŒ–å°±å¯¹6å–æ¨¡:
    shirtChoice: dnaStr.substring(4, 6) % 6 + 1,
    //æœ€å6ä½æ§åˆ¶é¢œè‰². ç”¨cssé€‰æ‹©å™¨: hue-rotateæ¥æ›´æ–°
    // 360åº¦:
    skinColorChoice: parseInt(dnaStr.substring(6, 8) / 100 * 360),
    eyeColorChoice: parseInt(dnaStr.substring(8, 10) / 100 * 360),
    clothesColorChoice: parseInt(dnaStr.substring(10, 12) / 100 * 360),
    zombieName: name,
    zombieDescription: "A Level 1 CryptoZombie",
  }
  return zombieDetails
}
```

æˆ‘ä»¬çš„ JavaScript æ‰€åšçš„å°±æ˜¯è·å–ç”±`zombieDetails` äº§ç”Ÿçš„æ•°æ®, å¹¶ä¸”åˆ©ç”¨æµè§ˆå™¨é‡Œçš„ JavaScript ç¥å¥‡åŠŸèƒ½ (æˆ‘ä»¬ç”¨ Vue.js)ï¼Œç½®æ¢å‡ºå›¾åƒä»¥åŠä½¿ç”¨CSSè¿‡æ»¤å™¨ã€‚åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å…¨éƒ¨çš„ä»£ç ã€‚

##### è¯•ä¸€ä¸‹å§!

åœ¨å³é¢çš„è¾“å…¥æ¡†é‡Œè¾“å…¥ä½ çš„åå­—ï¼Œçœ‹çœ‹ä½ èƒ½å¾—åˆ°å“ªç§åƒµå°¸ï¼

**ä¸€æ—¦ä½ å¾—åˆ°ä¸€ä¸ªæ»¡æ„çš„åƒµå°¸, ç‚¹å‡»ä¸‹é¢çš„ "ä¸‹ä¸€ç« " æŒ‰é’®ä¿å­˜ä½ çš„åƒµå°¸ï¼Œç»“æŸç¬¬ä¸€è¯¾!**

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/04/28/20220428145457.png" align="center" style="width:500px" />

##### å¤ªæ£’å•¦ï¼ä½ å®Œæˆäº† CryptoZombies çš„ç¬¬ä¸€ä¸ªè¯¾ç¨‹!

ä½ ç¦»è‡ªå·±ç¼–è¯‘åŒºå—é“¾æ¸¸æˆè·¨å‡ºäº†å¾ˆå¤§çš„ä¸€æ­¥ã€‚

##### è·Ÿä½ çš„æœ‹å‹ä»¬æ™’ä¸€æ™’ä½ æ–°çš„åƒµå°¸å§ï¼

è¿™æ˜¯ä½ çš„åƒµå°¸çš„æ°¸ä¹…åœ°å€:

https://share.cryptozombies.io/zh/lesson/1/share/GG?id=Y3p8MjEwMTY2

[åŠ å…¥æˆ‘ä»¬çš„Telegram](https://t.me/loomnetworkdev)



### 1.2 åƒµå°¸æ”»å‡»äººç±»

#### ç¬¬1ç«  ç¬¬äºŒè¯¾æ¦‚è§ˆ

åœ¨ç¬¬ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç”¨æ¥ç”Ÿæˆåƒµå°¸ï¼Œå¹¶ä¸”å°†å®ƒæ”¾å…¥åŒºå—é“¾ä¸Šçš„åƒµå°¸æ•°æ®åº“ä¸­ã€‚ åœ¨ç¬¬äºŒè¯¾é‡Œï¼Œæˆ‘ä»¬ä¼šè®©æˆ‘ä»¬çš„ app çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªæ¸¸æˆï¼š å®ƒå¾—æ”¯æŒå¤šç”¨æˆ·ï¼Œå¹¶ä¸”é‡‡ç”¨æ›´åŠ æœ‰è¶£,è€Œä¸ä»…ä»…ä½¿ç”¨éšæœºçš„æ–¹å¼ï¼Œæ¥ç”Ÿæˆæ–°çš„åƒµå°¸ã€‚

å¦‚ä½•ç”Ÿæˆæ–°çš„åƒµå°¸å‘¢ï¼Ÿé€šè¿‡è®©ç°æœ‰çš„åƒµå°¸çŒé£Ÿå…¶ä»–ç”Ÿç‰©ï¼

##### åƒµå°¸çŒé£Ÿ

åƒµå°¸çŒé£Ÿçš„æ—¶å€™ï¼Œåƒµå°¸ç—…æ¯’ä¾µå…¥çŒç‰©ï¼Œè¿™äº›ç—…æ¯’ä¼šå°†çŒç‰©å˜ä¸ºæ–°çš„åƒµå°¸ï¼ŒåŠ å…¥ä½ çš„åƒµå°¸å¤§å†›ã€‚ç³»ç»Ÿä¼šé€šè¿‡çŒç‰©å’ŒçŒé£Ÿè€…åƒµå°¸çš„DNAè®¡ç®—å‡ºæ–°åƒµå°¸çš„DNAã€‚

åƒµå°¸æœ€å–œæ¬¢çŒé£Ÿä»€ä¹ˆç‰©ç§å‘¢ï¼Ÿ ç­‰ä½ å­¦å®Œç¬¬äºŒè¯¾å°±çŸ¥é“äº†ï¼

##### å®æˆ˜æ¼”ä¹ 

å³è¾¹æ˜¯ä¸€ä¸ªç®€å•çš„çŒé£Ÿæ¼”ç¤ºã€‚ç‚¹å‡»ä¸€ä¸ªâ€œäººâ€ï¼Œçœ‹çœ‹åƒµå°¸çŒé£Ÿçš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ? å¯è§ï¼Œæ–°åƒµå°¸çš„DNAæ˜¯é€šè¿‡ä»åŸæ¥çš„åƒµå°¸çš„DNA, åŠ ä¸ŠçŒç‰©çš„DNAè®¡ç®—å¾—æ¥çš„ã€‚

å­¦å®Œè¿™ä¸€ç« ï¼Œè¯·ç‚¹å‡»â€œä¸‹ä¸€ç« â€ï¼Œ æˆ‘ä»¬è¯¥è®©æ¸¸æˆæ”¯æŒå¤šç©å®¶æ¨¡å¼äº†ã€‚

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/04/28/20220428161055.png" align="center" style="width:500px" />

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/04/28/20220428150659.png" align="center" style="width:500px" />



#### ç¬¬2ç«  æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰

æˆ‘ä»¬é€šè¿‡ç»™æ•°æ®åº“ä¸­çš„åƒµå°¸æŒ‡å®šâ€œä¸»äººâ€ï¼Œ æ¥æ”¯æŒâ€œå¤šç©å®¶â€æ¨¡å¼ã€‚

å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥2ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼š`mapping`ï¼ˆæ˜ å°„ï¼‰ å’Œ `address`ï¼ˆåœ°å€ï¼‰ã€‚

##### Addresses ï¼ˆåœ°å€ï¼‰

ä»¥å¤ªåŠåŒºå—é“¾ç”± **_ account _** (è´¦æˆ·)ç»„æˆï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦æˆ·ã€‚ä¸€ä¸ªå¸æˆ·çš„ä½™é¢æ˜¯ **_ä»¥å¤ª_** ï¼ˆåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šä½¿ç”¨çš„å¸ç§ï¼‰ï¼Œä½ å¯ä»¥å’Œå…¶ä»–å¸æˆ·ä¹‹é—´æ”¯ä»˜å’Œæ¥å—ä»¥å¤ªå¸ï¼Œå°±åƒä½ çš„é“¶è¡Œå¸æˆ·å¯ä»¥ç”µæ±‡èµ„é‡‘åˆ°å…¶ä»–é“¶è¡Œå¸æˆ·ä¸€æ ·ã€‚

æ¯ä¸ªå¸æˆ·éƒ½æœ‰ä¸€ä¸ªâ€œåœ°å€â€ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦å·ã€‚è¿™æ˜¯è´¦æˆ·å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒçœ‹èµ·æ¥é•¿è¿™æ ·ï¼š

```bash
0x0cE446255506E92DF41614C46F1d6df9Cc969183
```

ï¼ˆè¿™æ˜¯ CryptoZombies å›¢é˜Ÿçš„åœ°å€ï¼Œå¦‚æœä½ å–œæ¬¢ CryptoZombies çš„è¯ï¼Œè¯·æ‰“èµæˆ‘ä»¬ä¸€äº›ä»¥å¤ªå¸ï¼ğŸ˜‰ï¼‰

æˆ‘ä»¬å°†åœ¨åé¢çš„è¯¾ç¨‹ä¸­ä»‹ç»åœ°å€çš„ç»†èŠ‚ï¼Œç°åœ¨ä½ åªéœ€è¦äº†è§£**åœ°å€å±äºç‰¹å®šç”¨æˆ·ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„**ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®šâ€œåœ°å€â€ä½œä¸ºåƒµå°¸ä¸»äººçš„ IDã€‚å½“ç”¨æˆ·é€šè¿‡ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº¤äº’æ¥åˆ›å»ºæ–°çš„åƒµå°¸æ—¶ï¼Œæ–°åƒµå°¸çš„æ‰€æœ‰æƒè¢«è®¾ç½®åˆ°è°ƒç”¨è€…çš„ä»¥å¤ªåŠåœ°å€ä¸‹ã€‚

##### Mappingï¼ˆæ˜ å°„ï¼‰

åœ¨ç¬¬1è¯¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† **_ ç»“æ„ä½“ _** å’Œ **_ æ•°ç»„ _** ã€‚ **_æ˜ å°„_** æ˜¯å¦ä¸€ç§åœ¨ Solidity ä¸­å­˜å‚¨æœ‰ç»„ç»‡æ•°æ®çš„æ–¹æ³•ã€‚

æ˜ å°„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```solidity
//å¯¹äºé‡‘èåº”ç”¨ç¨‹åºï¼Œå°†ç”¨æˆ·çš„ä½™é¢ä¿å­˜åœ¨ä¸€ä¸ª uintç±»å‹çš„å˜é‡ä¸­ï¼š
mapping (address => uint) public accountBalance;
//æˆ–è€…å¯ä»¥ç”¨æ¥é€šè¿‡userId å­˜å‚¨/æŸ¥æ‰¾çš„ç”¨æˆ·å
mapping (uint => string) userIdToName;
```

æ˜ å°„æœ¬è´¨ä¸Šæ˜¯å­˜å‚¨å’ŒæŸ¥æ‰¾æ•°æ®æ‰€ç”¨çš„é”®-å€¼å¯¹ã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª `address`ï¼Œå€¼æ˜¯ä¸€ä¸ª `uint`ï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª`uint`ï¼Œå€¼æ˜¯ä¸€ä¸ª `string`ã€‚

##### å®æˆ˜æ¼”ä¹ 

ä¸ºäº†å­˜å‚¨åƒµå°¸çš„æ‰€æœ‰æƒï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°ä¸¤ä¸ªæ˜ å°„ï¼šä¸€ä¸ªè®°å½•åƒµå°¸æ‹¥æœ‰è€…çš„åœ°å€ï¼Œå¦ä¸€ä¸ªè®°å½•æŸåœ°å€æ‰€æ‹¥æœ‰åƒµå°¸çš„æ•°é‡ã€‚

1.åˆ›å»ºä¸€ä¸ªå«åš `zombieToOwner` çš„æ˜ å°„ã€‚å…¶é”®æ˜¯ä¸€ä¸ª`uint`ï¼ˆæˆ‘ä»¬å°†æ ¹æ®å®ƒçš„ id å­˜å‚¨å’ŒæŸ¥æ‰¾åƒµå°¸ï¼‰ï¼Œå€¼ä¸º `address`ã€‚æ˜ å°„å±æ€§ä¸º`public`ã€‚

2.åˆ›å»ºä¸€ä¸ªåä¸º `ownerZombieCount` çš„æ˜ å°„ï¼Œå…¶ä¸­é”®æ˜¯ `address`ï¼Œå€¼æ˜¯ `uint`ã€‚

``` solidity
//... other code ...
Zombie[] public zombies;
// è®°å½•åƒµå°¸æ‹¥æœ‰è€…åœ°å€
mapping(uint => address) public zombieToOwner;
// è®°å½•æŸåœ°å€æ‰€æ‹¥æœ‰çš„åƒµå°¸çš„æ•°é‡
mapping(address => uint) ownerZombieCount;
//... other code ...
```



#### ç¬¬3ç«  Msg.sender

ç°åœ¨æœ‰äº†ä¸€å¥—æ˜ å°„æ¥è®°å½•åƒµå°¸çš„æ‰€æœ‰æƒäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ `_createZombie` æ–¹æ³•æ¥è¿ç”¨å®ƒä»¬ã€‚

ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦ç”¨åˆ° `msg.sender`ã€‚

##### msg.sender

åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸€äº›å…¨å±€å˜é‡å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚ å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ `msg.sender`ï¼Œå®ƒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨è€…ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ `address`ã€‚

> æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼ŒåŠŸèƒ½æ‰§è¡Œå§‹ç»ˆéœ€è¦ä»å¤–éƒ¨è°ƒç”¨è€…å¼€å§‹ã€‚ ä¸€ä¸ªåˆçº¦åªä¼šåœ¨åŒºå—é“¾ä¸Šä»€ä¹ˆä¹Ÿä¸åšï¼Œé™¤éæœ‰äººè°ƒç”¨å…¶ä¸­çš„å‡½æ•°ã€‚æ‰€ä»¥ `msg.sender`æ€»æ˜¯å­˜åœ¨çš„ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ `msg.sender` æ¥æ›´æ–° `mapping` çš„ä¾‹å­ï¼š

```solidity
mapping (address => uint) favoriteNumber;

function setMyNumber(uint _myNumber) public {
  // æ›´æ–°æˆ‘ä»¬çš„ `favoriteNumber` æ˜ å°„æ¥å°† `_myNumber`å­˜å‚¨åœ¨ `msg.sender`åä¸‹
  favoriteNumber[msg.sender] = _myNumber;
  // å­˜å‚¨æ•°æ®è‡³æ˜ å°„çš„æ–¹æ³•å’Œå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ç›¸ä¼¼
}

function whatIsMyNumber() public view returns (uint) {
  // æ‹¿åˆ°å­˜å‚¨åœ¨è°ƒç”¨è€…åœ°å€åä¸‹çš„å€¼
  // è‹¥è°ƒç”¨è€…è¿˜æ²¡è°ƒç”¨ setMyNumberï¼Œ åˆ™å€¼ä¸º `0`
  return favoriteNumber[msg.sender];
}
```

åœ¨è¿™ä¸ªå°å°çš„ä¾‹å­ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ `setMyNumber` åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å­˜ä¸‹ä¸€ä¸ª `uint` å¹¶ä¸”ä¸ä»–ä»¬çš„åœ°å€ç›¸ç»‘å®šã€‚ ç„¶åï¼Œä»–ä»¬è°ƒç”¨ `whatIsMyNumber` å°±ä¼šè¿”å›ä»–ä»¬å­˜å‚¨çš„ `uint`ã€‚

ä½¿ç”¨ `msg.sender` å¾ˆå®‰å…¨ï¼Œå› ä¸ºå®ƒå…·æœ‰ä»¥å¤ªåŠåŒºå—é“¾çš„å®‰å…¨ä¿éšœ â€”â€” é™¤éçªƒå–ä¸ä»¥å¤ªåŠåœ°å€ç›¸å…³è”çš„ç§é’¥ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰åŠæ³•ä¿®æ”¹å…¶ä»–äººçš„æ•°æ®çš„ã€‚

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬æ¥ä¿®æ”¹ç¬¬1è¯¾çš„ `_createZombie` æ–¹æ³•ï¼Œå°†åƒµå°¸åˆ†é…ç»™å‡½æ•°è°ƒç”¨è€…å§ã€‚

1. é¦–å…ˆï¼Œåœ¨å¾—åˆ°æ–°çš„åƒµå°¸ `id` åï¼Œæ›´æ–° `zombieToOwner` æ˜ å°„ï¼Œåœ¨ `id` ä¸‹é¢å­˜å…¥ `msg.sender`ã€‚
2. ç„¶åï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ª `msg.sender` åä¸‹çš„ `ownerZombieCount` åŠ  1ã€‚

è·Ÿåœ¨ JavaScript ä¸­ä¸€æ ·ï¼Œ åœ¨ Solidity ä¸­ä½ ä¹Ÿå¯ä»¥ç”¨ `++` ä½¿ `uint` é€’å¢ã€‚

```solidity
uint number = 0;
number++;
// `number` ç°åœ¨æ˜¯ `1`äº†
```

ä¿®æ”¹ä¸¤è¡Œä»£ç å³å¯ã€‚

``` solidity
//... other code ...
uint id = zombies.length -1;
zombieToOwner[id] = msg.sender;
ownerZombieCount[msg.sender]++;
emit NewZombie(id, _name, _dna);
//... other code ...
```



#### ç¬¬4ç«  Require

åœ¨ç¬¬ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸè®©ç”¨æˆ·é€šè¿‡è°ƒç”¨ `createRandomZombie`å‡½æ•° å¹¶è¾“å…¥ä¸€ä¸ªåå­—æ¥åˆ›å»ºæ–°çš„åƒµå°¸ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·èƒ½æŒç»­è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºå‡ºæ— é™å¤šä¸ªåƒµå°¸åŠ å…¥ä»–ä»¬çš„å†›å›¢ï¼Œè¿™æ¸¸æˆå°±å¤ªæ²¡æ„æ€äº†ï¼

äºæ˜¯ï¼Œæˆ‘ä»¬ä½œå‡ºé™å®šï¼šæ¯ä¸ªç©å®¶åªèƒ½è°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå‡½æ•°ã€‚ è¿™æ ·ä¸€æ¥ï¼Œæ–°ç©å®¶å¯ä»¥åœ¨åˆšå¼€å§‹ç©æ¸¸æˆæ—¶é€šè¿‡è°ƒç”¨å®ƒï¼Œä¸ºå…¶å†›å›¢åˆ›å»ºåˆå§‹åƒµå°¸ã€‚

æˆ‘ä»¬æ€æ ·æ‰èƒ½é™å®šæ¯ä¸ªç©å®¶åªè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ä½¿ç”¨`require`ã€‚ `require`ä½¿å¾—å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æŠ›å‡ºé”™è¯¯ï¼Œå¹¶åœæ­¢æ‰§è¡Œï¼š

```solidity
function sayHiToVitalik(string _name) public returns (string) {
  // æ¯”è¾ƒ _name æ˜¯å¦ç­‰äº "Vitalik". å¦‚æœä¸æˆç«‹ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢ç¨‹åº
  // (æ•²é»‘æ¿: Solidity å¹¶ä¸æ”¯æŒåŸç”Ÿçš„å­—ç¬¦ä¸²æ¯”è¾ƒ, æˆ‘ä»¬åªèƒ½é€šè¿‡æ¯”è¾ƒ
  // ä¸¤å­—ç¬¦ä¸²çš„ keccak256 å“ˆå¸Œå€¼æ¥è¿›è¡Œåˆ¤æ–­)
  require(keccak256(_name) == keccak256("Vitalik"));
  // å¦‚æœè¿”å› true, è¿è¡Œå¦‚ä¸‹è¯­å¥
  return "Hi!";
}
```

å¦‚æœä½ è¿™æ ·è°ƒç”¨å‡½æ•° `sayHiToVitalikï¼ˆâ€œVitalikâ€ï¼‰` ,å®ƒä¼šè¿”å›â€œHiï¼â€ã€‚è€Œå¦‚æœè°ƒç”¨çš„æ—¶å€™ä½¿ç”¨äº†å…¶ä»–å‚æ•°ï¼Œå®ƒåˆ™ä¼šæŠ›å‡ºé”™è¯¯å¹¶åœæ­¢æ‰§è¡Œã€‚

å› æ­¤ï¼Œåœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼Œç”¨ `require` éªŒè¯å‰ç½®æ¡ä»¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚

##### å®æˆ˜æ¼”ä¹ 

åœ¨æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·é€šè¿‡åå¤è°ƒç”¨ `createRandomZombie` æ¥çµ¦ä»–ä»¬çš„å†›é˜Ÿåˆ›å»ºæ— é™å¤šä¸ªåƒµå°¸ â€”â€” è¿™å°†ä½¿å¾—æ¸¸æˆéå¸¸æ— èŠã€‚

æˆ‘ä»¬ä½¿ç”¨äº† `require` æ¥ç¡®ä¿è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨å®ƒçš„æ—¶å€™æ‰§è¡Œï¼Œç”¨ä»¥åˆ›å»ºåˆå§‹åƒµå°¸ã€‚

1. åœ¨ `createRandomZombie` çš„å‰é¢æ”¾ç½® `require` è¯­å¥ã€‚ ä½¿å¾—å‡½æ•°å…ˆæ£€æŸ¥ `ownerZombieCount [msg.sender]` çš„å€¼ä¸º `0` ï¼Œä¸ç„¶å°±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

> æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼Œå…³é”®è¯æ”¾ç½®çš„é¡ºåºå¹¶ä¸é‡è¦
>
> - è™½ç„¶å‚æ•°çš„ä¸¤ä¸ªä½ç½®æ˜¯ç­‰æ•ˆçš„ã€‚ ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ç­”æ¡ˆæ£€æŸ¥å™¨æ¯”è¾ƒå‘†æ¿ï¼Œå®ƒåªèƒ½è®¤å®šå…¶ä¸­ä¸€ä¸ªä¸ºæ­£ç¡®ç­”æ¡ˆ
> - äºæ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±çº¦å®šæŠŠ`ownerZombieCount [msg.sender]`æ”¾å‰é¢å§

``` solidity
function createRandomZombie(string _name) public {
    // start here
    require(ownerZombieCount[msg.sender] == 0);
    uint randDna = _generateRandomDna(_name);
    _createZombie(_name, randDna);
}
```



#### ç¬¬5ç«  ç»§æ‰¿ï¼ˆInheritanceï¼‰

æˆ‘ä»¬çš„æ¸¸æˆä»£ç è¶Šæ¥è¶Šé•¿ã€‚ å½“ä»£ç è¿‡äºå†—é•¿çš„æ—¶å€™ï¼Œæœ€å¥½å°†ä»£ç å’Œé€»è¾‘åˆ†æ‹†åˆ°å¤šä¸ªä¸åŒçš„åˆçº¦ä¸­ï¼Œä»¥ä¾¿äºç®¡ç†ã€‚

æœ‰ä¸ªè®© Solidity çš„ä»£ç æ˜“äºç®¡ç†çš„åŠŸèƒ½ï¼Œå°±æ˜¯åˆçº¦ ***inheritance*** (ç»§æ‰¿)ï¼š

```solidity
contract Doge {
  function catchphrase() public returns (string) {
    return "So Wow CryptoDoge";
  }
}

contract BabyDoge is Doge {
  function anotherCatchphrase() public returns (string) {
    return "Such Moon BabyDoge";
  }
}
```

ç”±äº `BabyDoge` æ˜¯ä» `Doge` é‚£é‡Œ ***inherits*** ï¼ˆç»§æ‰¿)è¿‡æ¥çš„ã€‚ è¿™æ„å‘³ç€å½“ä½ ç¼–è¯‘å’Œéƒ¨ç½²äº† `BabyDoge`ï¼Œå®ƒå°†å¯ä»¥è®¿é—® `catchphrase()` å’Œ `anotherCatchphrase()`å’Œå…¶ä»–æˆ‘ä»¬åœ¨ `Doge` ä¸­å®šä¹‰çš„å…¶ä»–å…¬å…±å‡½æ•°ã€‚

è¿™å¯ä»¥ç”¨äºé€»è¾‘ç»§æ‰¿ï¼ˆæ¯”å¦‚è¡¨è¾¾å­ç±»çš„æ—¶å€™ï¼Œ`Cat` æ˜¯ä¸€ç§ `Animal`ï¼‰ã€‚ ä½†ä¹Ÿå¯ä»¥ç®€å•åœ°å°†ç±»ä¼¼çš„é€»è¾‘ç»„åˆåˆ°ä¸åŒçš„åˆçº¦ä¸­ä»¥ç»„ç»‡ä»£ç ã€‚

##### å®æˆ˜æ¼”ä¹ 

åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¦ä¸ºåƒµå°¸å®ç°å„ç§åŠŸèƒ½ï¼Œè®©å®ƒå¯ä»¥â€œçŒé£Ÿâ€å’Œâ€œç¹æ®–â€ã€‚ é€šè¿‡å°†è¿™äº›è¿ç®—æ”¾åˆ°çˆ¶ç±» `ZombieFactory` ä¸­ï¼Œä½¿å¾—æ‰€æœ‰ `ZombieFactory` çš„ç»§æ‰¿è€…åˆçº¦éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚

1. åœ¨ `ZombieFactory` ä¸‹åˆ›å»ºä¸€ä¸ªå« `ZombieFeeding` çš„åˆçº¦ï¼Œå®ƒæ˜¯ç»§æ‰¿è‡ª `ZombieFactory åˆçº¦çš„ã€‚

``` solidity
contract ZombieFactory {
	// other code
}
contract ZombieFeeding is ZombieFactory {
}
```



#### ç¬¬6ç«  å¼•å…¥ï¼ˆImportï¼‰

å“‡ï¼ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åªæ˜¯æ¸…ç†äº†ä¸‹å³è¾¹çš„ä»£ç ï¼Œç°åœ¨ä½ çš„ç¼–è¾‘å™¨çš„é¡¶éƒ¨å°±å¤šäº†ä¸ªé€‰é¡¹å¡ã€‚ å°è¯•ç‚¹å‡»å®ƒçš„æ ‡ç­¾ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆå§ï¼

ä»£ç å·²ç»å¤Ÿé•¿äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†æˆå¤šä¸ªæ–‡ä»¶ä»¥ä¾¿äºç®¡ç†ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ Solidity é¡¹ç›®ä¸­çš„ä»£ç å¤ªé•¿çš„æ—¶å€™æˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚

åœ¨ Solidity ä¸­ï¼Œå½“ä½ æœ‰å¤šä¸ªæ–‡ä»¶å¹¶ä¸”æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `import` è¯­å¥ï¼š

```solidity
import "./someothercontract.sol";

contract newContract is SomeOtherContract {

}
```

è¿™æ ·å½“æˆ‘ä»¬åœ¨åˆçº¦ï¼ˆcontractï¼‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º `someothercontract.sol` çš„æ–‡ä»¶ï¼ˆ `./` å°±æ˜¯åŒä¸€ç›®å½•çš„æ„æ€ï¼‰ï¼Œå®ƒå°±ä¼šè¢«ç¼–è¯‘å™¨å¯¼å…¥ã€‚

##### å®æˆ˜æ¼”ä¹ 

ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªå¤šæ–‡ä»¶æ¶æ„ï¼Œå¹¶ç”¨ `import` æ¥è¯»å–æ¥è‡ªå¦ä¸€ä¸ªæ–‡ä»¶ä¸­åˆçº¦çš„å†…å®¹ï¼š

1.å°† `zombiefactory.sol` å¯¼å…¥åˆ°æˆ‘ä»¬çš„æ–°æ–‡ä»¶ `zombiefeeding.sol` ä¸­ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >= 0.4.19;

import "./zombiefactory.sol";

contract ZombieFeeding is ZombieFactory {
}
```



#### ç¬¬7ç«  Storageä¸Memory

åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å­˜å‚¨å˜é‡ â€”â€” `storage` æˆ– `memory`ã€‚

***Storage*** å˜é‡æ˜¯æŒ‡æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸­çš„å˜é‡ã€‚ ***Memory*** å˜é‡åˆ™æ˜¯ä¸´æ—¶çš„ï¼Œå½“å¤–éƒ¨å‡½æ•°å¯¹æŸåˆçº¦è°ƒç”¨å®Œæˆæ—¶ï¼Œå†…å­˜å‹å˜é‡å³è¢«ç§»é™¤ã€‚ ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå­˜å‚¨åœ¨ä½ ç”µè„‘çš„ç¡¬ç›˜æˆ–æ˜¯RAMä¸­æ•°æ®çš„å…³ç³»ã€‚

å¤§å¤šæ•°æ—¶å€™ä½ éƒ½ç”¨ä¸åˆ°è¿™äº›å…³é”®å­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ Solidity ä¼šè‡ªåŠ¨å¤„ç†å®ƒä»¬ã€‚ çŠ¶æ€å˜é‡ï¼ˆåœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„å˜é‡ï¼‰é»˜è®¤ä¸ºâ€œå­˜å‚¨â€å½¢å¼ï¼Œå¹¶æ°¸ä¹…å†™å…¥åŒºå—é“¾ï¼›è€Œåœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯â€œå†…å­˜â€å‹çš„ï¼Œå®ƒä»¬å‡½æ•°è°ƒç”¨ç»“æŸåæ¶ˆå¤±ã€‚

ç„¶è€Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨å£°æ˜å­˜å‚¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¤„ç†å‡½æ•°å†…çš„ **_ ç»“æ„ä½“ _** å’Œ **_ æ•°ç»„ _** æ—¶ï¼š

```solidity
contract SandwichFactory {
  struct Sandwich {
    string name;
    string status;
  }

  Sandwich[] sandwiches;

  function eatSandwich(uint _index) public {
    // Sandwich mySandwich = sandwiches[_index];

    // ^ çœ‹ä¸Šå»å¾ˆç›´æ¥ï¼Œä¸è¿‡ Solidity å°†ä¼šç»™å‡ºè­¦å‘Š
    // å‘Šè¯‰ä½ åº”è¯¥æ˜ç¡®åœ¨è¿™é‡Œå®šä¹‰ `storage` æˆ–è€… `memory`ã€‚

    // æ‰€ä»¥ä½ åº”è¯¥æ˜ç¡®å®šä¹‰ `storage`:
    Sandwich storage mySandwich = sandwiches[_index];
    // ...è¿™æ · `mySandwich` æ˜¯æŒ‡å‘ `sandwiches[_index]`çš„æŒ‡é’ˆ
    // åœ¨å­˜å‚¨é‡Œï¼Œå¦å¤–...
    mySandwich.status = "Eaten!";
    // ...è¿™å°†æ°¸ä¹…æŠŠ `sandwiches[_index]` å˜ä¸ºåŒºå—é“¾ä¸Šçš„å­˜å‚¨

    // å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥ä½¿ç”¨`memory`:
    Sandwich memory anotherSandwich = sandwiches[_index + 1];
    // ...è¿™æ · `anotherSandwich` å°±ä»…ä»…æ˜¯ä¸€ä¸ªå†…å­˜é‡Œçš„å‰¯æœ¬äº†
    // å¦å¤–
    anotherSandwich.status = "Eaten!";
    // ...å°†ä»…ä»…ä¿®æ”¹ä¸´æ—¶å˜é‡ï¼Œå¯¹ `sandwiches[_index + 1]` æ²¡æœ‰ä»»ä½•å½±å“
    // ä¸è¿‡ä½ å¯ä»¥è¿™æ ·åš:
    sandwiches[_index + 1] = anotherSandwich;
    // ...å¦‚æœä½ æƒ³æŠŠå‰¯æœ¬çš„æ”¹åŠ¨ä¿å­˜å›åŒºå—é“¾å­˜å‚¨
  }
}
```

å¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨ç†è§£ç©¶ç«Ÿåº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒ â€”â€” åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰ä½ ä½•æ—¶ä½¿ç”¨ `storage` æˆ–æ˜¯ `memory`ï¼Œå¹¶ä¸”å½“ä½ ä¸å¾—ä¸ä½¿ç”¨åˆ°è¿™äº›å…³é”®å­—çš„æ—¶å€™ï¼ŒSolidity ç¼–è¯‘å™¨ä¹Ÿå‘è­¦ç¤ºæé†’ä½ çš„ã€‚

ç°åœ¨ï¼Œåªè¦çŸ¥é“åœ¨æŸäº›åœºåˆä¸‹ä¹Ÿéœ€è¦ä½ æ˜¾å¼åœ°å£°æ˜ `storage` æˆ– `memory`å°±å¤Ÿäº†ï¼

##### å®æˆ˜æ¼”ä¹ 

æ˜¯æ—¶å€™ç»™æˆ‘ä»¬çš„åƒµå°¸å¢åŠ â€œçŒé£Ÿâ€å’Œâ€œç¹æ®–â€åŠŸèƒ½äº†ï¼

å½“ä¸€ä¸ªåƒµå°¸çŒé£Ÿå…¶ä»–ç”Ÿç‰©ä½“æ—¶ï¼Œå®ƒè‡ªèº«çš„DNAå°†ä¸çŒç‰©ç”Ÿç‰©çš„DNAç»“åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„åƒµå°¸DNAã€‚

1. åˆ›å»ºä¸€ä¸ªåä¸º `feedAndMultiply` çš„å‡½æ•°ã€‚ ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ï¼š`_zombieId`ï¼ˆ `uint`ç±»å‹ ï¼‰å’Œ`_targetDna` ï¼ˆä¹Ÿæ˜¯ `uint` ç±»å‹ï¼‰ã€‚ è®¾ç½®å±æ€§ä¸º `public` çš„ã€‚
2. æˆ‘ä»¬ä¸å¸Œæœ›åˆ«äººç”¨æˆ‘ä»¬çš„åƒµå°¸å»æ•çŒã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®ä¿å¯¹è‡ªå·±åƒµå°¸çš„æ‰€æœ‰æƒã€‚ é€šè¿‡æ·»åŠ ä¸€ä¸ª`require` è¯­å¥æ¥ç¡®ä¿ `msg.sender` åªèƒ½æ˜¯è¿™ä¸ªåƒµå°¸çš„ä¸»äººï¼ˆç±»ä¼¼äºæˆ‘ä»¬åœ¨ `createRandomZombie` å‡½æ•°ä¸­åšè¿‡çš„é‚£æ ·ï¼‰ã€‚

> æ³¨æ„ï¼šåŒæ ·ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç­”æ¡ˆæ£€æŸ¥å™¨æ¯”è¾ƒå‘†èŒï¼Œåªè®¤è¯†æŠŠ `msg.sender` æ”¾åœ¨å‰é¢çš„ç­”æ¡ˆï¼Œå¦‚æœä½ åˆ‡æ¢äº†å‚æ•°çš„é¡ºåºï¼Œå®ƒå°±ä¸è®¤å¾—äº†ã€‚ ä½†ä½ æ­£å¸¸ç¼–ç æ—¶ï¼Œå¦‚ä½•å®‰æ’å‚æ•°é¡ºåºéƒ½æ˜¯æ­£ç¡®çš„ã€‚

1. ä¸ºäº†è·å–è¿™ä¸ªåƒµå°¸çš„DNAï¼Œæˆ‘ä»¬çš„å‡½æ•°éœ€è¦å£°æ˜ä¸€ä¸ªåä¸º `myZombie` æ•°æ®ç±»å‹ä¸º`Zombie`çš„æœ¬åœ°å˜é‡ï¼ˆè¿™æ˜¯ä¸€ä¸ª `storage` å‹çš„æŒ‡é’ˆï¼‰ã€‚ å°†å…¶å€¼è®¾å®šä¸ºåœ¨ `zombies` æ•°ç»„ä¸­ç´¢å¼•ä¸º`_zombieId`æ‰€æŒ‡å‘çš„å€¼ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŒ…æ‹¬å‡½æ•°ç»“æŸç¬¦ `}` çš„é‚£ä¸€è¡Œï¼Œ æ€»å…±4è¡Œä»£ç ã€‚

ä¸‹ä¸€ç« é‡Œï¼Œæˆ‘ä»¬ä¼šç»§ç»­ä¸°å¯Œè¿™ä¸ªåŠŸèƒ½ã€‚

``` solidity
// SPDX-License-Identifier: MIT
pragma solidity >=0.4.19;

import "./zombiefactory.sol";

contract ZombieFeeding is ZombieFactory {
    function feedAndMultiply(uint256 _zombieId, uint256 _targetDna) public {
        require(msg.sender == zombieToOwner[_zombieId]);
        Zombie storage myZombie = zombies[_zombieId];
    }
}
```



#### ç¬¬8ç«  åƒµå°¸çš„DNA

æˆ‘ä»¬æ¥æŠŠ `feedAndMultiply` å‡½æ•°å†™å®Œå§ã€‚

è·å–æ–°çš„åƒµå°¸DNAçš„å…¬å¼å¾ˆç®€å•ï¼šè®¡ç®—çŒé£Ÿåƒµå°¸DNAå’Œè¢«çŒåƒµå°¸DNAä¹‹é—´çš„å¹³å‡å€¼ã€‚

ä¾‹å¦‚ï¼š

```solidity
function testDnaSplicing() public {
  uint zombieDna = 2222222222222222;
  uint targetDna = 4444444444444444;
  uint newZombieDna = (zombieDna + targetDna) / 2;
  // newZombieDna å°†ç­‰äº 3333333333333333
}
```

ä»¥åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©å‡½æ•°å˜å¾—æ›´å¤æ‚äº›ï¼Œæ¯”æ–¹ç»™æ–°çš„åƒµå°¸çš„ DNA å¢åŠ ä¸€äº›éšæœºæ€§ä¹‹ç±»çš„ã€‚ä½†ç°åœ¨å…ˆä»æœ€ç®€å•çš„å¼€å§‹ â€”â€” ä»¥åè¿˜å¯ä»¥å›æ¥å®Œå–„å®ƒå˜›ã€‚

##### å®æˆ˜æ¼”ä¹ 

1. é¦–å…ˆæˆ‘ä»¬ç¡®ä¿ `_targetDna` ä¸é•¿äº16ä½ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® `_targetDna` ä¸º `_targetDna ï¼… dnaModulus` ï¼Œå¹¶ä¸”åªå–å…¶æœ€å16ä½æ•°å­—ã€‚
2. æ¥ä¸‹æ¥ä¸ºæˆ‘ä»¬çš„å‡½æ•°å£°æ˜ä¸€ä¸ªåå« `newDna` çš„ `uint`ç±»å‹çš„å˜é‡ï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸º `myZombie`çš„ DNA å’Œ `_targetDna` çš„å¹³å‡å€¼ï¼ˆå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼‰ã€‚

> æ³¨æ„ï¼šæ‚¨å¯ä»¥ç”¨ `myZombie.name` æˆ– `myZombie.dna` è®¿é—® `myZombie` çš„å±æ€§ã€‚

1. ä¸€æ—¦æˆ‘ä»¬è®¡ç®—å‡ºæ–°çš„DNAï¼Œå†è°ƒç”¨ `_createZombie` å°±å¯ä»¥ç”Ÿæˆæ–°çš„åƒµå°¸äº†ã€‚å¦‚æœä½ å¿˜äº†è°ƒç”¨è¿™ä¸ªå‡½æ•°æ‰€éœ€è¦çš„å‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹ `zombiefactory.sol` é€‰é¡¹å¡ã€‚è¯·æ³¨æ„ï¼Œéœ€è¦å…ˆç»™å®ƒå‘½åï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬æŠŠæ–°çš„åƒµå°¸çš„åå­—è®¾ä¸º`NoName` - æˆ‘ä»¬å›å¤´å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ›´æ”¹åƒµå°¸çš„åå­—ã€‚

> æ³¨æ„ï¼šå¯¹äº Solidity é«˜æ‰‹ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬çš„ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚åˆ«æ‹…å¿ƒï¼Œä¸‹ä¸€ç« ä¼šè§£å†³è¿™ä¸ªé—®é¢˜çš„ ;ï¼‰

``` solidity
function feedAndMultiply(uint256 _zombieId, uint256 _targetDna) public {
    require(msg.sender == zombieToOwner[_zombieId]);
    Zombie storage myZombie = zombies[_zombieId];

    _targetDna = _targetDna % dnaModulus;
    uint256 newDna = (myZombie.dna + _targetDna) / 2;
    _createZombie("NoName", newDna);
}
```



#### ç¬¬9ç« : æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§

**æˆ‘ä»¬ä¸Šä¸€è¯¾çš„ä»£ç æœ‰é—®é¢˜ï¼**

ç¼–è¯‘çš„æ—¶å€™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚

é”™è¯¯åœ¨äºï¼Œæˆ‘ä»¬å°è¯•ä» `ZombieFeeding` ä¸­è°ƒç”¨ `_createZombie` å‡½æ•°ï¼Œä½† `_createZombie` å´æ˜¯ `ZombieFactory` çš„ `private` ï¼ˆç§æœ‰ï¼‰å‡½æ•°ã€‚è¿™æ„å‘³ç€ä»»ä½•ç»§æ‰¿è‡ª `ZombieFactory` çš„å­åˆçº¦éƒ½ä¸èƒ½è®¿é—®å®ƒã€‚

##### internal å’Œ external

é™¤ `public` å’Œ `private` å±æ€§ä¹‹å¤–ï¼ŒSolidity è¿˜ä½¿ç”¨äº†å¦å¤–ä¸¤ä¸ªæè¿°å‡½æ•°å¯è§æ€§çš„ä¿®é¥°è¯ï¼š`internal`ï¼ˆå†…éƒ¨ï¼‰ å’Œ `external`ï¼ˆå¤–éƒ¨ï¼‰ã€‚

`internal` å’Œ `private` ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œ å¦‚æœæŸä¸ªåˆçº¦ç»§æ‰¿è‡ªå…¶çˆ¶åˆçº¦ï¼Œè¿™ä¸ªåˆçº¦å³å¯ä»¥è®¿é—®çˆ¶åˆçº¦ä¸­å®šä¹‰çš„â€œå†…éƒ¨â€å‡½æ•°ã€‚ï¼ˆå˜¿ï¼Œè¿™å¬èµ·æ¥æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£æ ·ï¼ï¼‰ã€‚

`external` ä¸`public` ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™äº›å‡½æ•°åªèƒ½åœ¨åˆçº¦ä¹‹å¤–è°ƒç”¨ - å®ƒä»¬ä¸èƒ½è¢«åˆçº¦å†…çš„å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚ç¨åæˆ‘ä»¬å°†è®¨è®ºä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `external` å’Œ `public`ã€‚

å£°æ˜å‡½æ•° `internal` æˆ– `external` ç±»å‹çš„è¯­æ³•ï¼Œä¸å£°æ˜ `private` å’Œ `public`ç±» å‹ç›¸åŒï¼š

```solidity
contract Sandwich {
  uint private sandwichesEaten = 0;

  function eat() internal {
    sandwichesEaten++;
  }
}

contract BLT is Sandwich {
  uint private baconSandwichesEaten = 0;

  function eatWithBacon() public returns (string) {
    baconSandwichesEaten++;
    // å› ä¸ºeat() æ˜¯internal çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿™é‡Œè°ƒç”¨
    eat();
  }
}
```

##### å®æˆ˜æ¼”ä¹ 

1. å°† `_createZombie()` å‡½æ•°çš„å±æ€§ä» `private` æ”¹ä¸º `internal` ï¼Œ ä½¿å¾—å…¶ä»–çš„åˆçº¦ä¹Ÿèƒ½è®¿é—®åˆ°å®ƒã€‚

   æˆ‘ä»¬å·²ç»æˆåŠŸæŠŠä½ çš„æ³¨æ„åŠ›é›†ä¸­åœ¨åˆ°`zombiefactory.sol`è¿™ä¸ªé€‰é¡¹å¡ä¸Šå•¦ã€‚

``` solidity
function _createZombie(string memory _name, uint _dna) internal {
    zombies.push(Zombie(_name, _dna));
    // è¿™é‡Œè§¦å‘äº‹ä»¶
    uint id = zombies.length -1;
    zombieToOwner[id] = msg.sender;
    ownerZombieCount[msg.sender]++;
    emit NewZombie(id, _name, _dna);
}
```



#### ç¬¬10ç« : åƒµå°¸åƒä»€ä¹ˆ?

æ˜¯æ—¶å€™è®©æˆ‘ä»¬çš„åƒµå°¸å»æ•çŒï¼ é‚£åƒµå°¸æœ€å–œæ¬¢çš„é£Ÿç‰©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

Crypto åƒµå°¸å–œæ¬¢åƒçš„æ˜¯...

**CryptoKittiesï¼** ğŸ˜±ğŸ˜±ğŸ˜±

ï¼ˆæ­£ç»ç‚¹ï¼Œæˆ‘å¯ä¸æ˜¯å¼€ç©ç¬‘ğŸ˜†ï¼‰

ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦è¯»å‡º CryptoKitties æ™ºèƒ½åˆçº¦ä¸­çš„ kittyDnaã€‚è¿™äº›æ•°æ®æ˜¯å…¬å¼€å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„ã€‚åŒºå—é“¾æ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿ

åˆ«æ‹…å¿ƒ â€”â€” æˆ‘ä»¬çš„æ¸¸æˆå¹¶ä¸ä¼šä¼¤å®³åˆ°ä»»ä½•çœŸæ­£çš„CryptoKittyã€‚ æˆ‘ä»¬åª *è¯»å–* CryptoKitties æ•°æ®ï¼Œä½†å´æ— æ³•åœ¨ç‰©ç†ä¸Šåˆ é™¤å®ƒã€‚

##### ä¸å…¶ä»–åˆçº¦çš„äº¤äº’

å¦‚æœæˆ‘ä»¬çš„åˆçº¦éœ€è¦å’ŒåŒºå—é“¾ä¸Šçš„å…¶ä»–çš„åˆçº¦ä¼šè¯ï¼Œåˆ™éœ€å…ˆå®šä¹‰ä¸€ä¸ª ***interface*** (æ¥å£)ã€‚

å…ˆä¸¾ä¸€ä¸ªç®€å•çš„æ —å­ã€‚ å‡è®¾åœ¨åŒºå—é“¾ä¸Šæœ‰è¿™ä¹ˆä¸€ä¸ªåˆçº¦ï¼š

```solidity
contract LuckyNumber {
  mapping(address => uint) numbers;

  function setNum(uint _num) public {
    numbers[msg.sender] = _num;
  }

  function getNum(address _myAddress) public view returns (uint) {
    return numbers[_myAddress];
  }
}
```

è¿™æ˜¯ä¸ªå¾ˆç®€å•çš„åˆçº¦ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒå­˜å‚¨è‡ªå·±çš„å¹¸è¿å·ç ï¼Œå¹¶å°†å…¶ä¸æ‚¨çš„ä»¥å¤ªåŠåœ°å€å…³è”ã€‚ è¿™æ ·å…¶ä»–äººå°±å¯ä»¥é€šè¿‡æ‚¨çš„åœ°å€æŸ¥æ‰¾æ‚¨çš„å¹¸è¿å·ç äº†ã€‚

ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨åˆçº¦ï¼Œä½¿ç”¨ `getNum` å‡½æ•°å¯è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ `LuckyNumber` åˆçº¦çš„ ***interface*** ï¼š

```solidity
interface NumberInterface {
  function getNum(address _myAddress) public view returns (uint);
}
```

è¯·æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹è™½ç„¶çœ‹èµ·æ¥åƒåœ¨å®šä¹‰ä¸€ä¸ªåˆçº¦ï¼Œä½†å…¶å®å†…é‡Œä¸åŒï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬åªå£°æ˜äº†è¦ä¸ä¹‹äº¤äº’çš„å‡½æ•° â€”â€” åœ¨æœ¬ä¾‹ä¸­ä¸º `getNum` â€”â€” åœ¨å…¶ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å…¶ä»–çš„å‡½æ•°æˆ–çŠ¶æ€å˜é‡ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨å¤§æ‹¬å·ï¼ˆ`{` å’Œ `}`ï¼‰å®šä¹‰å‡½æ•°ä½“ï¼Œæˆ‘ä»¬å•å•ç”¨åˆ†å·ï¼ˆ`;`ï¼‰ç»“æŸäº†å‡½æ•°å£°æ˜ã€‚è¿™ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåˆçº¦æ¡†æ¶ã€‚

ç¼–è¯‘å™¨å°±æ˜¯é è¿™äº›ç‰¹å¾è®¤å‡ºå®ƒæ˜¯ä¸€ä¸ªæ¥å£çš„ã€‚

åœ¨æˆ‘ä»¬çš„ app ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œåˆçº¦å°±çŸ¥é“å…¶ä»–åˆçº¦çš„å‡½æ•°æ˜¯æ€æ ·çš„ï¼Œåº”è¯¥å¦‚ä½•è°ƒç”¨ï¼Œä»¥åŠå¯æœŸå¾…ä»€ä¹ˆç±»å‹çš„è¿”å›å€¼ã€‚

åœ¨ä¸‹ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†çœŸæ­£è°ƒç”¨å…¶ä»–åˆçº¦çš„å‡½æ•°ã€‚ç›®å‰æˆ‘ä»¬åªè¦å£°æ˜ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè°ƒç”¨ CryptoKitties åˆçº¦å°±è¡Œäº†ã€‚

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬å·²ç»ä¸ºä½ æŸ¥çœ‹è¿‡äº† CryptoKitties çš„æºä»£ç ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†ä¸€ä¸ªåä¸º `getKitty`çš„å‡½æ•°ï¼Œå®ƒè¿”å›æ‰€æœ‰çš„åŠ å¯†çŒ«çš„æ•°æ®ï¼ŒåŒ…æ‹¬å®ƒçš„â€œåŸºå› â€ï¼ˆæˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè¦ç”¨å®ƒç”Ÿæˆæ–°çš„åƒµå°¸ï¼‰ã€‚

è¯¥å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š

```solidity
function getKitty(uint256 _id) external view returns (
    bool isGestating,
    bool isReady,
    uint256 cooldownIndex,
    uint256 nextActionAt,
    uint256 siringWithId,
    uint256 birthTime,
    uint256 matronId,
    uint256 sireId,
    uint256 generation,
    uint256 genes
) {
    Kitty storage kit = kitties[_id];

    // if this variable is 0 then it's not gestating
    isGestating = (kit.siringWithId != 0);
    isReady = (kit.cooldownEndBlock <= block.number);
    cooldownIndex = uint256(kit.cooldownIndex);
    nextActionAt = uint256(kit.cooldownEndBlock);
    siringWithId = uint256(kit.siringWithId);
    birthTime = uint256(kit.birthTime);
    matronId = uint256(kit.matronId);
    sireId = uint256(kit.sireId);
    generation = uint256(kit.generation);
    genes = kit.genes;
}
```

è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥è·Ÿæˆ‘ä»¬ä¹ æƒ¯çš„å‡½æ•°ä¸å¤ªä¸€æ ·ã€‚ å®ƒç«Ÿç„¶è¿”å›äº†...ä¸€å †ä¸åŒçš„å€¼ï¼ å¦‚æœæ‚¨ç”¨è¿‡ JavaScript ä¹‹ç±»çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€å®šä¼šæ„Ÿåˆ°å¥‡æ€ª â€”â€” åœ¨ Solidityä¸­ï¼Œæ‚¨å¯ä»¥è®©ä¸€ä¸ªå‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°é•¿ä»€ä¹ˆæ ·çš„äº†ï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæ¥å£ï¼š

1.å®šä¹‰ä¸€ä¸ªåä¸º `KittyInterface` çš„æ¥å£ã€‚ è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† `contract` å…³é”®å­—ï¼Œ è¿™è¿‡ç¨‹çœ‹èµ·æ¥å°±åƒåˆ›å»ºä¸€ä¸ªæ–°çš„åˆçº¦ä¸€æ ·ã€‚

2.åœ¨interfaceé‡Œå®šä¹‰äº† `getKitty` å‡½æ•°ï¼ˆä¸è¿‡æ˜¯å¤åˆ¶/ç²˜è´´ä¸Šé¢çš„å‡½æ•°ï¼Œä½†åœ¨ `returns` è¯­å¥ä¹‹åç”¨åˆ†å·ï¼Œè€Œä¸æ˜¯å¤§æ‹¬å·å†…çš„æ‰€æœ‰å†…å®¹ã€‚

``` solidity
interface KittyInterface {
    function getKitty(uint256 _id)
        external
        view
        returns (
            bool isGestating,
            bool isReady,
            uint256 cooldownIndex,
            uint256 nextActionAt,
            uint256 siringWithId,
            uint256 birthTime,
            uint256 matronId,
            uint256 sireId,
            uint256 generation,
            uint256 genes
        );
}
```



#### ç¬¬11ç«  ä½¿ç”¨æ¥å£

ç»§ç»­å‰é¢ `NumberInterface` çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ—¢ç„¶å°†æ¥å£å®šä¹‰ä¸ºï¼š

```solidity
interface NumberInterface {
  function getNum(address _myAddress) public view returns (uint);
}
```

æˆ‘ä»¬å¯ä»¥åœ¨åˆçº¦ä¸­è¿™æ ·ä½¿ç”¨ï¼š

```solidity
contract MyContract {
  address NumberInterfaceAddress = 0xab38...;
  // ^ è¿™æ˜¯FavoriteNumberåˆçº¦åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€
  NumberInterface numberContract = NumberInterface(NumberInterfaceAddress);
  // ç°åœ¨å˜é‡ `numberContract` æŒ‡å‘å¦ä¸€ä¸ªåˆçº¦å¯¹è±¡

  function someFunction() public {
    // ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨åœ¨é‚£ä¸ªåˆçº¦ä¸­å£°æ˜çš„ `getNum`å‡½æ•°:
    uint num = numberContract.getNum(msg.sender);
    // ...åœ¨è¿™å„¿ä½¿ç”¨ `num`å˜é‡åšäº›ä»€ä¹ˆ
  }
}
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªè¦å°†æ‚¨åˆçº¦çš„å¯è§æ€§è®¾ç½®ä¸º`public`(å…¬å…±)æˆ–`external`(å¤–éƒ¨)ï¼Œå®ƒä»¬å°±å¯ä»¥ä¸ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»»ä½•å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’ã€‚

##### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬æ¥å»ºä¸ªè‡ªå·±çš„åˆçº¦å»è¯»å–å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦-- CryptoKitties çš„å†…å®¹å§ï¼

1. æˆ‘å·²ç»å°†ä»£ç ä¸­ CryptoKitties åˆçº¦çš„åœ°å€ä¿å­˜åœ¨ä¸€ä¸ªåä¸º `ckAddress` çš„å˜é‡ä¸­ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸º `kittyContract` çš„ KittyInterfaceï¼Œå¹¶ç”¨ `ckAddress` ä¸ºå®ƒåˆå§‹åŒ– â€”â€” å°±åƒæˆ‘ä»¬ä¸º `numberContract`æ‰€åšçš„ä¸€æ ·ã€‚



#### ç¬¬12ç«  å¤„ç†å¤šè¿”å›å€¼

`getKitty` æ˜¯æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªè¿”å›å¤šä¸ªå€¼çš„å‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š

```solidity
function multipleReturns() internal returns(uint a, uint b, uint c) {
  return (1, 2, 3);
}

function processMultipleReturns() external {
  uint a;
  uint b;
  uint c;
  // è¿™æ ·æ¥åšæ‰¹é‡èµ‹å€¼:
  (a, b, c) = multipleReturns();
}

// æˆ–è€…å¦‚æœæˆ‘ä»¬åªæƒ³è¿”å›å…¶ä¸­ä¸€ä¸ªå˜é‡:
function getLastReturnValue() external {
  uint c;
  // å¯ä»¥å¯¹å…¶ä»–å­—æ®µç•™ç©º:
  (,,c) = multipleReturns();
}
```

##### å®æˆ˜æ¼”ä¹ 

æ˜¯æ—¶å€™ä¸ CryptoKitties åˆçº¦äº¤äº’èµ·æ¥äº†ï¼

æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä» kitty åˆçº¦ä¸­è·å–å®ƒçš„åŸºå› ï¼š

1. åˆ›å»ºä¸€ä¸ªåä¸º `feedOnKitty` çš„å‡½æ•°ã€‚å®ƒéœ€è¦2ä¸ª `uint` ç±»å‹çš„å‚æ•°ï¼Œ`_zombieId` å’Œ`_kittyId` ï¼Œè¿™æ˜¯ä¸€ä¸ª `public` ç±»å‹çš„å‡½æ•°ã€‚

2. å‡½æ•°é¦–å…ˆè¦å£°æ˜ä¸€ä¸ªåä¸º `kittyDna` çš„ `uint`ã€‚

   > æ³¨æ„ï¼šåœ¨æˆ‘ä»¬çš„ `KittyInterface` ä¸­ï¼Œ`genes` æ˜¯ä¸€ä¸ª `uint256` ç±»å‹çš„å˜é‡ï¼Œä½†æ˜¯å¦‚æœä½ è®°å¾—ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€è¯¾ä¸­æåˆ°è¿‡ï¼Œ`uint` æ˜¯ `uint256` çš„åˆ«åï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ˜¯ä¸€å›äº‹ã€‚

3. è¿™ä¸ªå‡½æ•°æ¥ä¸‹æ¥è°ƒç”¨ `kittyContract.getKitty`å‡½æ•°, ä¼ å…¥ `_kittyId` ï¼Œå°†è¿”å›çš„ `genes` å­˜å‚¨åœ¨ `kittyDna` ä¸­ã€‚è®°ä½ â€”â€” `getKitty` ä¼šè¿”å›ä¸€å¤§å †å˜é‡ã€‚ ï¼ˆç¡®åˆ‡åœ°è¯´10ä¸ª - æˆ‘å·²ç»ä¸ºä½ æ•°è¿‡äº†ï¼Œä¸é”™å§ï¼ï¼‰ã€‚ä½†æ˜¯æˆ‘ä»¬åªå…³å¿ƒæœ€åä¸€ä¸ª-- `genes`ã€‚æ•°é€—å·çš„æ—¶å€™å°å¿ƒç‚¹å“¦ï¼

4. æœ€åï¼Œå‡½æ•°è°ƒç”¨äº† `feedAndMultiply` ï¼Œå¹¶ä¼ å…¥äº† `_zombieId` å’Œ `kittyDna` ä¸¤ä¸ªå‚æ•°ã€‚

``` solidity
function feedOnKitty(uint _zombieId, uint _kittyId) public {
    uint kittyDna;
    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);
    feedAndMultiply(_zombieId, kittyDna);
}
```



#### ç¬¬13ç«  å¥–åŠ±: Kitty åŸºå› 

æˆ‘ä»¬çš„åŠŸèƒ½é€»è¾‘ä¸»ä½“å·²ç»å®Œæˆäº†...ç°åœ¨è®©æˆ‘ä»¬æ¥æ·»ä¸€ä¸ªå¥–åŠ±åŠŸèƒ½å§ã€‚

è¿™æ ·å§ï¼Œç»™ä»å°çŒ«åˆ¶é€ å‡ºçš„åƒµå°¸æ·»åŠ äº›ç‰¹å¾ï¼Œä»¥æ˜¾ç¤ºä»–ä»¬æ˜¯çŒ«åƒµå°¸ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå’±ä»¬åœ¨æ–°åƒµå°¸çš„DNAä¸­æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„å°çŒ«ä»£ç ã€‚

è¿˜è®°å¾—å—ï¼Œç¬¬ä¸€è¯¾ä¸­æˆ‘ä»¬æåˆ°ï¼Œæˆ‘ä»¬ç›®å‰åªä½¿ç”¨16ä½DNAçš„å‰12ä½æ•°æ¥æŒ‡å®šåƒµå°¸çš„å¤–è§‚ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€å2ä¸ªæ•°å­—æ¥å¤„ç†â€œç‰¹æ®Šâ€çš„ç‰¹å¾ã€‚

è¿™æ ·å§ï¼ŒæŠŠçŒ«åƒµå°¸DNAçš„æœ€åä¸¤ä¸ªæ•°å­—è®¾å®šä¸º`99`ï¼ˆå› ä¸ºçŒ«æœ‰9æ¡å‘½ï¼‰ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬è¿™ä¹ˆæ¥å†™ä»£ç ï¼š`å¦‚æœ`è¿™ä¸ªåƒµå°¸æ˜¯ä¸€åªçŒ«å˜æ¥çš„ï¼Œå°±å°†å®ƒDNAçš„æœ€åä¸¤ä½æ•°å­—è®¾ç½®ä¸º`99`ã€‚

##### if è¯­å¥

ifè¯­å¥çš„è¯­æ³•åœ¨ Solidity ä¸­ï¼Œä¸åœ¨ JavaScript ä¸­å·®ä¸å¤šï¼š

```solidity
function eatBLT(string sandwich) public {
  // çœ‹æ¸…æ¥šäº†ï¼Œå½“æˆ‘ä»¬æ¯”è¾ƒå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œéœ€è¦æ¯”è¾ƒä»–ä»¬çš„ keccak256 å“ˆå¸Œç 
  if (keccak256(sandwich) == keccak256("BLT")) {
    eat();
  }
}
```

##### å®æˆ˜æ¼”ä¹ 

è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„åƒµå°¸ä»£ç ä¸­å®ç°å°çŒ«çš„åŸºå› ã€‚

1. é¦–å…ˆï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹ `feedAndMultiply` å‡½æ•°çš„å®šä¹‰ï¼Œç»™å®ƒä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¸€æ¡åä¸º `_species` çš„å­—ç¬¦ä¸²ã€‚

2. æ¥ä¸‹æ¥ï¼Œåœ¨æˆ‘ä»¬è®¡ç®—å‡ºæ–°çš„åƒµå°¸çš„DNAä¹‹åï¼Œæ·»åŠ ä¸€ä¸ª `if` è¯­å¥æ¥æ¯”è¾ƒ `_species` å’Œå­—ç¬¦ä¸² `"kitty"` çš„ `keccak256` å“ˆå¸Œå€¼ã€‚

3. åœ¨ `if` è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ç”¨ `99` æ›¿æ¢äº†æ–°åƒµå°¸DNAçš„æœ€åä¸¤ä½æ•°å­—ã€‚å¯ä»¥è¿™ä¹ˆåšï¼š`newDna = newDna - newDna % 100 + 99;`ã€‚

   > è§£é‡Šï¼šå‡è®¾ `newDna` æ˜¯ `334455`ã€‚é‚£ä¹ˆ `newDna % 100` æ˜¯ `55`ï¼Œæ‰€ä»¥ `newDna - newDna % 100` å¾—åˆ° `334400`ã€‚æœ€ååŠ ä¸Š `99` å¯å¾—åˆ° `334499`ã€‚

4. æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹äº† `feedOnKitty` ä¸­çš„å‡½æ•°è°ƒç”¨ã€‚å½“å®ƒè°ƒç”¨ `feedAndMultiply` æ—¶ï¼Œå¢åŠ  `â€œkittyâ€` ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ã€‚

``` solidity
contract ZombieFeeding is ZombieFactory {

    address ckAddress = 0x06012c8cf97BEaD5deAe237070F9587f8E7A266d;
    KittyInterface kittyContract = KittyInterface(ckAddress);
    
    function feedAndMultiply(uint256 _zombieId, uint256 _targetDna, string memory _species) public {
        require(msg.sender == zombieToOwner[_zombieId]);
        Zombie storage myZombie = zombies[_zombieId];

        _targetDna = _targetDna % dnaModulus;
        uint256 newDna = (myZombie.dna + _targetDna) / 2;
        // è¿™é‡Œå¢åŠ ä¸€ä¸ª if è¯­å¥
        if(keccak256(abi.encode(_species)) == keccak256(abi.encode("kitty"))){
            newDna = newDna - newDna % 100 + 99;
        }
        _createZombie("NoName", newDna);
    }

    function feedOnKitty(uint _zombieId, uint _kittyId) public {
        uint kittyDna;
        (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);
        feedAndMultiply(_zombieId, kittyDna, "kitty");
    }
}
```



#### ç¬¬14ç«  æ”¾åœ¨ä¸€èµ·

è‡³æ­¤ï¼Œä½ å·²ç»å­¦å®Œç¬¬äºŒè¯¾äº†ï¼

æŸ¥çœ‹ä¸‹â†’_â†’çš„æ¼”ç¤ºï¼Œçœ‹çœ‹ä»–ä»¬æ€ä¹ˆè¿è¡Œèµ·æ¥å¾—å§ã€‚ç»§ç»­ï¼Œä½ è‚¯å®šç­‰ä¸åŠçœ‹å®Œè¿™ä¸€é¡µğŸ˜‰ã€‚ç‚¹å‡»å°çŒ«ï¼Œæ”»å‡»ï¼çœ‹åˆ°ä½ æ–©è·ä¸€ä¸ªæ–°çš„å°çŒ«åƒµå°¸äº†å§ï¼

##### JavaScript å®ç°

æˆ‘ä»¬åªç”¨ç¼–è¯‘å’Œéƒ¨ç½² `ZombieFeeding`ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªåˆçº¦éƒ¨ç½²åˆ°ä»¥å¤ªåŠäº†ã€‚æˆ‘ä»¬æœ€ç»ˆå®Œæˆçš„è¿™ä¸ªåˆçº¦ç»§æ‰¿è‡ª `ZombieFactory`ï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®è‡ªå·±å’Œçˆ¶è¾ˆåˆçº¦ä¸­çš„æ‰€æœ‰ public æ–¹æ³•ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸æˆ‘ä»¬çš„åˆšéƒ¨ç½²çš„åˆçº¦è¿›è¡Œäº¤äº’çš„ä¾‹å­ï¼Œ è¿™ä¸ªä¾‹å­ä½¿ç”¨äº† JavaScript å’Œ web3.jsï¼š

```javascript
var abi = /* abi generated by the compiler */
var ZombieFeedingContract = web3.eth.contract(abi)
var contractAddress = /* our contract address on Ethereum after deploying */
var ZombieFeeding = ZombieFeedingContract.at(contractAddress)

// å‡è®¾æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„åƒµå°¸IDå’Œè¦æ”»å‡»çš„çŒ«å’ªID
let zombieId = 1;
let kittyId = 1;

// è¦æ‹¿åˆ°çŒ«å’ªçš„DNAï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ƒçš„APIã€‚è¿™äº›æ•°æ®ä¿å­˜åœ¨å®ƒä»¬çš„æœåŠ¡å™¨ä¸Šè€Œä¸æ˜¯åŒºå—é“¾ä¸Šã€‚
// å¦‚æœä¸€åˆ‡éƒ½åœ¨åŒºå—é“¾ä¸Šï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„æœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–è€…å®ƒä»¬ä¿®æ”¹äº†APIï¼Œ
// æˆ–è€…å› ä¸ºä¸å–œæ¬¢æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè€Œå°æ€äº†æˆ‘ä»¬
let apiUrl = "https://api.cryptokitties.co/kitties/" + kittyId
$.get(apiUrl, function(data) {
  let imgUrl = data.image_url
  // ä¸€äº›æ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç 
})

// å½“ç”¨æˆ·ç‚¹å‡»ä¸€åªçŒ«å’ªçš„æ—¶å€™:
$(".kittyImage").click(function(e) {
  // è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„ `feedOnKitty` å‡½æ•°
  ZombieFeeding.feedOnKitty(zombieId, kittyId)
})

// ä¾¦å¬æ¥è‡ªæˆ‘ä»¬åˆçº¦çš„æ–°åƒµå°¸äº‹ä»¶å¥½æ¥å¤„ç†
ZombieFactory.NewZombie(function(error, result) {
  if (error) return
  // è¿™ä¸ªå‡½æ•°ç”¨æ¥æ˜¾ç¤ºåƒµå°¸:
  generateZombie(result.zombieId, result.name, result.dna)
})
```

##### å®æˆ˜æ¼”ä¹ 

é€‰æ‹©ä¸€åªä½ æƒ³çŒé£Ÿçš„å°çŒ«ã€‚ä½ è‡ªå®¶åƒµå°¸çš„ DNA ä¼šå’Œå°çŒ«çš„ DNA ç»“åˆï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å°çŒ«åƒµå°¸ï¼ŒåŠ å…¥ä½ çš„å†›å›¢ï¼

çœ‹åˆ°æ–°åƒµå°¸ä¸Šé‚£å¯çˆ±çš„çŒ«å’ªè…¿äº†ä¹ˆï¼Ÿè¿™æ˜¯æ–°åƒµå°¸æœ€åDNAä¸­æœ€åä¸¤ä½æ•°å­— `99` çš„åŠŸåŠ³ï¼

ä½ æƒ³è¦çš„è¯éšæ—¶å¯ä»¥é‡æ–°å¼€å§‹ã€‚æ•è·äº†ä¸€åªçŒ«å’ªåƒµå°¸ï¼Œä½ ä¸€å®šå¾ˆé«˜å…´å§ï¼ï¼ˆä¸è¿‡ä½ åªèƒ½æŒæœ‰ä¸€åªï¼‰ï¼Œç»§ç»­å‰è¿›åˆ°ä¸‹ä¸€ç« ï¼Œå®Œæˆç¬¬äºŒè¯¾å§ï¼

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/05/05/20220505101833.png" align="center" style="width:500px" />

<img src="https://markdown-res.oss-cn-hangzhou.aliyuncs.com/mdImgs/2022/05/05/20220505101937.png" align="center" style="width:500px" />

##### ä½ å¥½æ£’ï¼å¤ªæ£’å•¦ï¼ä½ å®Œæˆäº† CryptoZombies çš„ç¬¬äºŒè¯¾!

**æˆåŠŸè§£é”äº†:**

- GGè¢«å‡çº§åˆ°äºŒçº§!
- æ— åï½ åƒµå°¸å·²åŠ å…¥ä½ çš„éƒ¨é˜Ÿ! (åˆ«æ‹…å¿ƒï¼Œç¬¬ä¸‰èŠ‚è¯¾é‡Œä½ ä¼šæœ‰æœºä¼šæ”¹å®ƒçš„åå­—)

##### æ™’ä¸€æ™’ä½ çš„ CryptoKitty-çŒæ€è€…ï¼å’Œä½ çš„æœ‹å‹ä»¬åˆ†äº«ï¼

è¿™æ˜¯ä½ çš„åƒµå°¸çš„æ°¸ä¹…åœ°å€ï¼Œè®©ä½ çš„æœ‹å‹è·Ÿä½ ä¸€èµ·çŒæ€ CryptoKitties:

https://share.cryptozombies.io/zh/lesson/2/share/GG?id=Y3p8MjEwMTY2



### 1.3 é«˜çº§ Solidity ç†è®º

#### ç¬¬1ç«  æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²çš„ Solidity å’Œå…¶ä»–è¯­è¨€æ²¡æœ‰è´¨çš„åŒºåˆ«ï¼Œå®ƒé•¿å¾—ä¹Ÿå¾ˆåƒ JavaScriptã€‚

ä½†æ˜¯ï¼Œåœ¨æœ‰å‡ ç‚¹ä»¥å¤ªåŠä¸Šçš„ DApp è·Ÿæ™®é€šçš„åº”ç”¨ç¨‹åºæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚

ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä½ æŠŠæ™ºèƒ½åè®®ä¼ ä¸Šä»¥å¤ªåŠä¹‹åï¼Œå®ƒå°±å˜å¾—***ä¸å¯æ›´æ”¹\***, è¿™ç§æ°¸å›ºæ€§æ„å‘³ç€ä½ çš„ä»£ç æ°¸è¿œä¸èƒ½è¢«è°ƒæ•´æˆ–æ›´æ–°ã€‚

ä½ ç¼–è¯‘çš„ç¨‹åºä¼šä¸€ç›´ï¼Œæ°¸ä¹…çš„ï¼Œä¸å¯æ›´æ”¹çš„ï¼Œå­˜åœ¨ä»¥å¤ªåŠä¸Šã€‚è¿™å°±æ˜¯ Solidity ä»£ç çš„å®‰å…¨æ€§å¦‚æ­¤é‡è¦çš„ä¸€ä¸ªåŸå› ã€‚å¦‚æœä½ çš„æ™ºèƒ½åè®®æœ‰ä»»ä½•æ¼æ´ï¼Œå³ä½¿ä½ å‘ç°äº†ä¹Ÿæ— æ³•è¡¥æ•‘ã€‚ä½ åªèƒ½è®©ä½ çš„ç”¨æˆ·ä»¬æ”¾å¼ƒè¿™ä¸ªæ™ºèƒ½åè®®ï¼Œç„¶åè½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„ä¿®å¤åçš„åˆçº¦ä¸Šã€‚

ä½†è¿™æ°å¥½ä¹Ÿæ˜¯æ™ºèƒ½åˆçº¦çš„ä¸€å¤§ä¼˜åŠ¿ã€‚ä»£ç è¯´æ˜ä¸€åˆ‡ã€‚å¦‚æœä½ å»è¯»æ™ºèƒ½åˆçº¦çš„ä»£ç ï¼Œå¹¶éªŒè¯å®ƒï¼Œä½ ä¼šå‘ç°ï¼Œä¸€æ—¦å‡½æ•°è¢«å®šä¹‰ä¸‹æ¥ï¼Œæ¯ä¸€æ¬¡çš„è¿è¡Œï¼Œç¨‹åºéƒ½ä¼šä¸¥æ ¼éµç…§å‡½æ•°ä¸­åŸæœ‰çš„ä»£ç é€»è¾‘ä¸€ä¸ä¸è‹Ÿåœ°æ‰§è¡Œï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒå‡½æ•°è¢«äººç¯¡æ”¹è€Œå¾—åˆ°æ„å¤–çš„ç»“æœã€‚

##### å¤–éƒ¨ä¾èµ–å…³ç³»

åœ¨ç¬¬2è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†åŠ å¯†å°çŒ«ï¼ˆCryptoKittiesï¼‰åˆçº¦çš„åœ°å€ç¡¬ç¼–ç åˆ° DApp ä¸­å»äº†ã€‚æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå¦‚æœåŠ å¯†å°çŒ«å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ¯”æ–¹è¯´ï¼Œé›†ä½“æ¶ˆå¤±äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ è™½ç„¶è¿™ç§äº‹æƒ…å‡ ä¹ä¸å¯èƒ½å‘ç”Ÿï¼Œä½†æ˜¯ï¼Œå¦‚æœå°çŒ«æ²¡äº†ï¼Œæˆ‘ä»¬çš„ DApp ä¹Ÿä¼šéšä¹‹å¤±æ•ˆ -- å› ä¸ºæˆ‘ä»¬åœ¨ DApp çš„ä»£ç ä¸­ç”¨â€œç¡¬ç¼–ç â€çš„æ–¹å¼æŒ‡å®šäº†åŠ å¯†å°çŒ«çš„åœ°å€ï¼Œå¦‚æœè¿™ä¸ªæ ¹æ®åœ°å€æ‰¾ä¸åˆ°å°çŒ«ï¼Œæˆ‘ä»¬çš„åƒµå°¸ä¹Ÿå°±åƒä¸åˆ°å°çŒ«äº†ï¼Œè€ŒæŒ‰ç…§å‰é¢çš„æè¿°ï¼Œæˆ‘ä»¬å´æ²¡æ³•ä¿®æ”¹åˆçº¦å»åº”ä»˜è¿™ä¸ªå˜åŒ–ï¼

å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡¬ç¼–ç ï¼Œè€Œè¦é‡‡ç”¨â€œå‡½æ•°â€ï¼Œä»¥ä¾¿äº DApp çš„å…³é”®éƒ¨åˆ†å¯ä»¥ä»¥å‚æ•°å½¢å¼ä¿®æ”¹ã€‚

æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬ä¸å†ä¸€å¼€å§‹å°±æŠŠçŒç‰©åœ°å€ç»™å†™å…¥ä»£ç ï¼Œè€Œæ˜¯å†™ä¸ªå‡½æ•° `setKittyContractAddress`, è¿è¡Œæ—¶å†è®¾å®šçŒç‰©çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ—¶å»é”å®šæ–°çš„çŒç‰©ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒåŠ å¯†å°çŒ«é›†ä½“æ¶ˆå¤±äº†ã€‚

##### å®æˆ˜æ¼”ä¹ 

è¯·ä¿®æ”¹ç¬¬2è¯¾çš„ä»£ç ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡ç¨‹åºæ›´æ”¹ CryptoKitties åˆçº¦åœ°å€ã€‚

1. åˆ é™¤é‡‡ç”¨ç¡¬ç¼–ç  æ–¹å¼çš„ `ckAddress` ä»£ç è¡Œã€‚
2. ä¹‹å‰åˆ›å»º `kittyContract` å˜é‡çš„é‚£è¡Œä»£ç ï¼Œä¿®æ”¹ä¸ºå¯¹ `kittyContract` å˜é‡çš„å£°æ˜ -- æš‚æ—¶ä¸ç»™å®ƒæŒ‡å®šå…·ä½“çš„å®ä¾‹ã€‚
3. åˆ›å»ºåä¸º `setKittyContractAddress` çš„å‡½æ•°ï¼Œ å®ƒå¸¦ä¸€ä¸ªå‚æ•° `_address`ï¼ˆ`address`ç±»å‹ï¼‰ï¼Œ å¯è§æ€§è®¾ä¸º`external`ã€‚
4. åœ¨å‡½æ•°å†…éƒ¨ï¼Œæ·»åŠ ä¸€è¡Œä»£ç ï¼Œå°† `kittyContract` å˜é‡è®¾ç½®ä¸ºè¿”å›å€¼ï¼š`KittyInterfaceï¼ˆ_addressï¼‰`ã€‚

> æ³¨æ„ï¼šä½ å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªåŠŸèƒ½æœ‰ä¸ªå®‰å…¨æ¼æ´ï¼Œåˆ«æ‹…å¿ƒ - å’±ä»¬åˆ°ä¸‹ä¸€ç« é‡Œè§£å†³å®ƒ;ï¼‰

``` solidity
contract ZombieFeeding is ZombieFactory {

    KittyInterface kittyContract;

    function setKittyContractAddress(address _address) external {
        kittyContract = KittyInterface(_address);
    }
    // ... other code ...
}
```



#### ç¬¬2ç«  Ownable Contracts

ä¸Šä¸€ç« ä¸­ï¼Œæ‚¨æœ‰æ²¡æœ‰å‘ç°ä»»ä½•å®‰å…¨æ¼æ´å‘¢ï¼Ÿ

å‘€ï¼`setKittyContractAddress` å¯è§æ€§å±…ç„¶ç”³æ˜ä¸ºâ€œå¤–éƒ¨çš„â€ï¼ˆ`external`ï¼‰ï¼Œå²‚ä¸æ˜¯ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨å®ƒï¼ ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•è°ƒç”¨è¯¥å‡½æ•°çš„äººéƒ½å¯ä»¥æ›´æ”¹ CryptoKitties åˆçº¦çš„åœ°å€ï¼Œä½¿å¾—å…¶ä»–äººéƒ½æ²¡æ³•å†è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚

æˆ‘ä»¬ç¡®å®æ˜¯å¸Œæœ›è¿™ä¸ªåœ°å€èƒ½å¤Ÿåœ¨åˆçº¦ä¸­ä¿®æ”¹ï¼Œä½†æˆ‘å¯æ²¡è¯´è®©æ¯ä¸ªäººå»æ”¹å®ƒå‘€ã€‚

è¦å¯¹ä»˜è¿™æ ·çš„æƒ…å†µï¼Œé€šå¸¸çš„åšæ³•æ˜¯æŒ‡å®šåˆçº¦çš„â€œæ‰€æœ‰æƒâ€ - å°±æ˜¯è¯´ï¼Œç»™å®ƒæŒ‡å®šä¸€ä¸ªä¸»äººï¼ˆæ²¡é”™ï¼Œå°±æ˜¯æ‚¨ï¼‰ï¼Œåªæœ‰ä¸»äººå¯¹å®ƒäº«æœ‰ç‰¹æƒã€‚

##### OpenZeppelinåº“çš„`Ownable` åˆçº¦

ä¸‹é¢æ˜¯ä¸€ä¸ª `Ownable` åˆçº¦çš„ä¾‹å­ï¼š æ¥è‡ª **_ OpenZeppelin _** Solidity åº“çš„ `Ownable` åˆçº¦ã€‚ OpenZeppelin æ˜¯ä¸»æ‰“å®‰ä¿å’Œç¤¾åŒºå®¡æŸ¥çš„æ™ºèƒ½åˆçº¦åº“ï¼Œæ‚¨å¯ä»¥åœ¨è‡ªå·±çš„ DAppsä¸­å¼•ç”¨ã€‚ç­‰æŠŠè¿™ä¸€è¯¾å­¦å®Œï¼Œæ‚¨ä¸è¦å‚¬æˆ‘ä»¬å‘å¸ƒä¸‹ä¸€è¯¾ï¼Œæœ€å¥½åˆ©ç”¨è¿™ä¸ªæ—¶é—´æŠŠ OpenZeppelin çš„ç½‘ç«™çœ‹çœ‹ï¼Œä¿ç®¡æ‚¨ä¼šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼

æŠŠæ¥¼ä¸‹è¿™ä¸ªåˆçº¦è¯»è¯»é€šï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰äº›æ²¡è§è¿‡ä»£ç ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬éšåä¼šè§£é‡Šã€‚

```solidity
/**
 * @title Ownable
 * @dev The Ownable contract has an owner address, and provides basic authorization control
 * functions, this simplifies the implementation of "user permissions".
 */
contract Ownable {
  address public owner;
  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);

  /**
   * @dev The Ownable constructor sets the original `owner` of the contract to the sender
   * account.
   */
  function Ownable() public {
    owner = msg.sender;
  }

  /**
   * @dev Throws if called by any account other than the owner.
   */
  modifier onlyOwner() {
    require(msg.sender == owner);
    _;
  }

  /**
   * @dev Allows the current owner to transfer control of the contract to a newOwner.
   * @param newOwner The address to transfer ownership to.
   */
  function transferOwnership(address newOwner) public onlyOwner {
    require(newOwner != address(0));
    OwnershipTransferred(owner, newOwner);
    owner = newOwner;
  }
}
```

ä¸‹é¢æœ‰æ²¡æœ‰æ‚¨æ²¡å­¦è¿‡çš„ä¸œä¸œï¼Ÿ

- æ„é€ å‡½æ•°ï¼š`function Ownable()`æ˜¯ä¸€ä¸ª **_ constructor_** (æ„é€ å‡½æ•°)ï¼Œæ„é€ å‡½æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒä¸åˆçº¦åŒåï¼Œæ„é€ å‡½æ•°ä¸€ç”Ÿä¸­å”¯ä¸€çš„ä¸€æ¬¡æ‰§è¡Œï¼Œå°±æ˜¯åœ¨åˆçº¦æœ€åˆè¢«åˆ›å»ºçš„æ—¶å€™ã€‚
- å‡½æ•°ä¿®é¥°ç¬¦ï¼š`modifier onlyOwner()`ã€‚ ä¿®é¥°ç¬¦è·Ÿå‡½æ•°å¾ˆç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ç”¨æ¥ä¿®é¥°å…¶ä»–å·²æœ‰å‡½æ•°ç”¨çš„ï¼Œ åœ¨å…¶ä»–è¯­å¥æ‰§è¡Œå‰ï¼Œä¸ºå®ƒæ£€æŸ¥ä¸‹å…ˆéªŒæ¡ä»¶ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä¸ªä¿®é¥°ç¬¦ `onlyOwner` æ£€æŸ¥ä¸‹è°ƒç”¨è€…ï¼Œç¡®ä¿åªæœ‰åˆçº¦çš„ä¸»äººæ‰èƒ½è¿è¡Œæœ¬å‡½æ•°ã€‚æˆ‘ä»¬ä¸‹ä¸€ç« ä¸­ä¼šè¯¦ç»†è®²è¿°ä¿®é¥°ç¬¦ï¼Œä»¥åŠé‚£ä¸ªå¥‡æ€ªçš„`_;`ã€‚
- `indexed` å…³é”®å­—ï¼šåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬è¿˜ç”¨ä¸åˆ°å®ƒã€‚

æ‰€ä»¥`Ownable` åˆçº¦åŸºæœ¬éƒ½ä¼šè¿™ä¹ˆå¹²ï¼š

1. åˆçº¦åˆ›å»ºï¼Œæ„é€ å‡½æ•°å…ˆè¡Œï¼Œå°†å…¶ `owner` è®¾ç½®ä¸º`msg.sender`ï¼ˆå…¶éƒ¨ç½²è€…ï¼‰
2. ä¸ºå®ƒåŠ ä¸Šä¸€ä¸ªä¿®é¥°ç¬¦ `onlyOwner`ï¼Œå®ƒä¼šé™åˆ¶é™Œç”Ÿäººçš„è®¿é—®ï¼Œå°†è®¿é—®æŸäº›å‡½æ•°çš„æƒé™é”å®šåœ¨ `owner` ä¸Šã€‚
3. å…è®¸å°†åˆçº¦æ‰€æœ‰æƒè½¬è®©ç»™ä»–äººã€‚

`onlyOwner` ç®€ç›´äººè§äººçˆ±ï¼Œå¤§å¤šæ•°äººå¼€å‘è‡ªå·±çš„ Solidity DAppsï¼Œéƒ½æ˜¯ä»å¤åˆ¶/ç²˜è´´ `Ownable` å¼€å§‹çš„ï¼Œä»å®ƒå†ç»§æ‰¿å‡ºçš„å­ç±»ï¼Œå¹¶åœ¨ä¹‹ä¸Šè¿›è¡ŒåŠŸèƒ½å¼€å‘ã€‚

æ—¢ç„¶æˆ‘ä»¬æƒ³æŠŠ `setKittyContractAddress` é™åˆ¶ä¸º `onlyOwner` ï¼Œæˆ‘ä»¬ä¹Ÿè¦åšåŒæ ·çš„äº‹æƒ…ã€‚

##### å®æˆ˜æ¼”ä¹ 

é¦–å…ˆï¼Œå°† `Ownable` åˆçº¦çš„ä»£ç å¤åˆ¶ä¸€ä»½åˆ°æ–°æ–‡ä»¶ `ownable.sol` ä¸­ã€‚ æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª `ZombieFactory`ï¼Œç»§æ‰¿ `Ownable`ã€‚

1.åœ¨ç¨‹åºä¸­å¯¼å…¥ `ownable.sol` çš„å†…å®¹ã€‚ å¦‚æœæ‚¨ä¸è®°å¾—æ€ä¹ˆåšäº†ï¼Œå‚è€ƒä¸‹ `zombiefeeding.sol`ã€‚

2.ä¿®æ”¹ `ZombieFactory` åˆçº¦ï¼Œ è®©å®ƒç»§æ‰¿è‡ª `Ownable`ã€‚ å¦‚æœæ‚¨ä¸è®°å¾—æ€ä¹ˆåšäº†ï¼Œçœ‹çœ‹ `zombiefeeding.sol`ã€‚

``` solidity
// 1. åœ¨è¿™é‡Œå¯¼å…¥
import "./ownable.sol";
// 2. åœ¨è¿™é‡Œç»§æ‰¿:
contract ZombieFactory is Ownable {
	// ... other code ...
}
```



#### ç¬¬3ç«  onlyOwner å‡½æ•°ä¿®é¥°ç¬¦

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸ªåŸºæœ¬ç‰ˆçš„åˆçº¦ `ZombieFactory` äº†ï¼Œå®ƒç»§æ‰¿è‡ª `Ownable` æ¥å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™ `ZombieFeeding` åŠ ä¸Š `onlyOwner` å‡½æ•°ä¿®é¥°ç¬¦ã€‚

è¿™å°±æ˜¯åˆçº¦ç»§æ‰¿çš„å·¥ä½œåŸç†ã€‚è®°å¾—ï¼š

```
ZombieFeeding æ˜¯ä¸ª ZombieFactory
ZombieFactory æ˜¯ä¸ª Ownable
```

å› æ­¤ `ZombieFeeding` ä¹Ÿæ˜¯ä¸ª `Ownable`, å¹¶å¯ä»¥é€šè¿‡ `Ownable` æ¥å£è®¿é—®çˆ¶ç±»ä¸­çš„å‡½æ•°/äº‹ä»¶/ä¿®é¥°ç¬¦ã€‚å¾€åï¼Œ`ZombieFeeding` çš„ç»§æ‰¿è€…åˆçº¦ä»¬åŒæ ·ä¹Ÿå¯ä»¥è¿™ä¹ˆå»¶ç»­ä¸‹å»ã€‚

##### å‡½æ•°ä¿®é¥°ç¬¦

å‡½æ•°ä¿®é¥°ç¬¦çœ‹èµ·æ¥è·Ÿå‡½æ•°æ²¡ä»€ä¹ˆä¸åŒï¼Œä¸è¿‡å…³é”®å­—`modifier` å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯ä¸ª`modifier(ä¿®é¥°ç¬¦)`ï¼Œè€Œä¸æ˜¯ä¸ª`function(å‡½æ•°)`ã€‚å®ƒä¸èƒ½åƒå‡½æ•°é‚£æ ·è¢«ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½è¢«æ·»åŠ åˆ°å‡½æ•°å®šä¹‰çš„æœ«å°¾ï¼Œç”¨ä»¥æ”¹å˜å‡½æ•°çš„è¡Œä¸ºã€‚

å’±ä»¬ä»”ç»†è¯»è¯» `onlyOwner`:

```solidity
/**
 * @dev è°ƒç”¨è€…ä¸æ˜¯â€˜ä¸»äººâ€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸
 */
modifier onlyOwner() {
  require(msg.sender == owner);
  _;
}
```

`onlyOwner` å‡½æ•°ä¿®é¥°ç¬¦æ˜¯è¿™ä¹ˆç”¨çš„ï¼š

```solidity
contract MyContract is Ownable {
  event LaughManiacally(string laughter);

  //æ³¨æ„ï¼ `onlyOwner`ä¸Šåœº :
  function likeABoss() external onlyOwner {
    LaughManiacally("Muahahahaha");
  }
}
```

æ³¨æ„ `likeABoss` å‡½æ•°ä¸Šçš„ `onlyOwner` ä¿®é¥°ç¬¦ã€‚ å½“ä½ è°ƒç”¨ `likeABoss` æ—¶ï¼Œ**é¦–å…ˆæ‰§è¡Œ** `onlyOwner` ä¸­çš„ä»£ç ï¼Œ æ‰§è¡Œåˆ° `onlyOwner` ä¸­çš„ `_;` è¯­å¥æ—¶ï¼Œç¨‹åºå†è¿”å›å¹¶æ‰§è¡Œ `likeABoss` ä¸­çš„ä»£ç ã€‚

å¯è§ï¼Œå°½ç®¡å‡½æ•°ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥åº”ç”¨åˆ°å„ç§åœºåˆï¼Œä½†æœ€å¸¸è§çš„è¿˜æ˜¯æ”¾åœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰æ·»åŠ å¿«é€Ÿçš„ `require`æ£€æŸ¥ã€‚

å› ä¸ºç»™å‡½æ•°æ·»åŠ äº†ä¿®é¥°ç¬¦ `onlyOwner`ï¼Œä½¿å¾—**å”¯æœ‰åˆçº¦çš„ä¸»äºº**ï¼ˆä¹Ÿå°±æ˜¯éƒ¨ç½²è€…ï¼‰æ‰èƒ½è°ƒç”¨å®ƒã€‚

> æ³¨æ„ï¼šä¸»äººå¯¹åˆçº¦äº«æœ‰çš„ç‰¹æƒå½“ç„¶æ˜¯æ­£å½“çš„ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½è¢«æ¶æ„ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œä¸‡ä¸€ï¼Œä¸»äººæ·»åŠ äº†ä¸ªåé—¨ï¼Œå…è®¸ä»–å·èµ°åˆ«äººçš„åƒµå°¸å‘¢ï¼Ÿ

> æ‰€ä»¥éå¸¸é‡è¦çš„æ˜¯ï¼Œéƒ¨ç½²åœ¨ä»¥å¤ªåŠä¸Šçš„ DAppï¼Œå¹¶ä¸èƒ½ä¿è¯å®ƒçœŸæ­£åšåˆ°å»ä¸­å¿ƒï¼Œä½ éœ€è¦é˜…è¯»å¹¶ç†è§£å®ƒçš„æºä»£ç ï¼Œæ‰èƒ½é˜²æ­¢å…¶ä¸­æ²¡æœ‰è¢«éƒ¨ç½²è€…æ¶æ„æ¤å…¥åé—¨ï¼›ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¦‚ä½•åšåˆ°æ—¢è¦ç»™è‡ªå·±ç•™ä¸‹ä¿®å¤ bug çš„ä½™åœ°ï¼Œåˆè¦å°½é‡åœ°æ”¾æƒç»™ä½¿ç”¨è€…ï¼Œä»¥ä¾¿è®©ä»–ä»¬æ”¾å¿ƒä½ ï¼Œä»è€Œæ„¿æ„æŠŠæ•°æ®æ”¾åœ¨ä½ çš„ DApp ä¸­ï¼Œè¿™ç¡®å®éœ€è¦ä¸ªå¾®å¦™çš„å¹³è¡¡ã€‚

##### å®æˆ˜æ¼”ä¹ 

ç°åœ¨æˆ‘ä»¬å¯ä»¥é™åˆ¶ç¬¬ä¸‰æ–¹å¯¹ `setKittyContractAddress`çš„è®¿é—®ï¼Œé™¤äº†æˆ‘ä»¬è‡ªå·±ï¼Œè°éƒ½æ— æ³•å»ä¿®æ”¹å®ƒã€‚

1. å°† `onlyOwner` å‡½æ•°ä¿®é¥°ç¬¦æ·»åŠ åˆ° `setKittyContractAddress` ä¸­ã€‚

``` solidity
function setKittyContractAddress(address _address) external onlyOwner {
    kittyContract = KittyInterface(_address);
}
```



#### ç¬¬4ç«  Gas

å‰å®³ï¼ç°åœ¨æˆ‘ä»¬æ‡‚äº†å¦‚ä½•åœ¨ç¦æ­¢ç¬¬ä¸‰æ–¹ä¿®æ”¹æˆ‘ä»¬çš„åˆçº¦çš„åŒæ—¶ï¼Œç•™ä¸ªåé—¨ç»™å’±ä»¬è‡ªå·±å»ä¿®æ”¹ã€‚

è®©æˆ‘ä»¬æ¥çœ‹å¦ä¸€ç§ä½¿å¾— Solidity ç¼–ç¨‹è¯­è¨€ä¸ä¼—ä¸åŒçš„ç‰¹å¾ï¼š

##### Gas - é©±åŠ¨ä»¥å¤ªåŠDAppsçš„èƒ½æº

åœ¨ Solidity ä¸­ï¼Œä½ çš„ç”¨æˆ·æƒ³è¦æ¯æ¬¡æ‰§è¡Œä½ çš„ DApp éƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„ ***gas***ï¼Œgas å¯ä»¥ç”¨ä»¥å¤ªå¸è´­ä¹°ï¼Œå› æ­¤ï¼Œç”¨æˆ·æ¯æ¬¡è·‘ DApp éƒ½å¾—èŠ±è´¹ä»¥å¤ªå¸ã€‚

ä¸€ä¸ª DApp æ”¶å–å¤šå°‘ gas å–å†³äºåŠŸèƒ½é€»è¾‘çš„å¤æ‚ç¨‹åº¦ã€‚æ¯ä¸ªæ“ä½œèƒŒåï¼Œéƒ½åœ¨è®¡ç®—å®Œæˆè¿™ä¸ªæ“ä½œæ‰€éœ€è¦çš„è®¡ç®—èµ„æºï¼Œï¼ˆæ¯”å¦‚ï¼Œå­˜å‚¨æ•°æ®å°±æ¯”åšä¸ªåŠ æ³•è¿ç®—è´µå¾—å¤šï¼‰ï¼Œ ä¸€æ¬¡æ“ä½œæ‰€éœ€è¦èŠ±è´¹çš„ ***gas*** ç­‰äºè¿™ä¸ªæ“ä½œèƒŒåçš„æ‰€æœ‰è¿ç®—èŠ±é”€çš„æ€»å’Œã€‚

ç”±äºè¿è¡Œä½ çš„ç¨‹åºéœ€è¦èŠ±è´¹ç”¨æˆ·çš„çœŸé‡‘ç™½é“¶ï¼Œåœ¨ä»¥å¤ªåŠä¸­ä»£ç çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å…¶ä»–ä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½æ›´å¼ºè°ƒä¼˜åŒ–ã€‚åŒæ ·çš„åŠŸèƒ½ï¼Œä½¿ç”¨ç¬¨æ‹™çš„ä»£ç å¼€å‘çš„ç¨‹åºï¼Œæ¯”èµ·ç»è¿‡ç²¾å·§ä¼˜åŒ–çš„ä»£ç æ¥ï¼Œè¿è¡ŒèŠ±è´¹æ›´é«˜ï¼Œè¿™æ˜¾ç„¶ä¼šç»™æˆåƒä¸Šä¸‡çš„ç”¨æˆ·å¸¦æ¥å¤§é‡ä¸å¿…è¦çš„å¼€é”€ã€‚

##### ä¸ºä»€ä¹ˆè¦ç”¨ ***gas*** æ¥é©±åŠ¨ï¼Ÿ

ä»¥å¤ªåŠå°±åƒä¸€ä¸ªå·¨å¤§ã€ç¼“æ…¢ã€ä½†éå¸¸å®‰å…¨çš„ç”µè„‘ã€‚å½“ä½ è¿è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨è¿›è¡Œç›¸åŒçš„è¿ç®—ï¼Œä»¥éªŒè¯å®ƒçš„è¾“å‡º â€”â€” è¿™å°±æ˜¯æ‰€è°“çš„â€œå»ä¸­å¿ƒåŒ–â€ ç”±äºæ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹åŒæ—¶åœ¨éªŒè¯ç€æ¯ä¸ªåŠŸèƒ½çš„è¿è¡Œï¼Œè¿™å¯ä»¥ç¡®ä¿å®ƒçš„æ•°æ®ä¸ä¼šè¢«è¢«ç›‘æ§ï¼Œæˆ–è€…è¢«åˆ»æ„ä¿®æ”¹ã€‚

å¯èƒ½ä¼šæœ‰ç”¨æˆ·ç”¨æ— é™å¾ªç¯å µå¡ç½‘ç»œï¼ŒæŠ‘æˆ–ç”¨å¯†é›†è¿ç®—æ¥å ç”¨å¤§é‡çš„ç½‘ç»œèµ„æºï¼Œä¸ºäº†é˜²æ­¢è¿™ç§äº‹æƒ…çš„å‘ç”Ÿï¼Œä»¥å¤ªåŠçš„åˆ›å»ºè€…ä¸ºä»¥å¤ªåŠä¸Šçš„èµ„æºåˆ¶å®šäº†ä»·æ ¼ï¼Œæƒ³è¦åœ¨ä»¥å¤ªåŠä¸Šè¿ç®—æˆ–è€…å­˜å‚¨ï¼Œä½ éœ€è¦å…ˆä»˜è´¹ã€‚

> æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨ä¾§é“¾ï¼Œå€’æ˜¯ä¸ä¸€å®šéœ€è¦ä»˜è´¹ï¼Œæ¯”å¦‚å’±ä»¬åœ¨ Loom Network ä¸Šæ„å»ºçš„ CryptoZombies å°±å…è´¹ã€‚ä½ ä¸ä¼šæƒ³è¦åœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸Šç©å„¿â€œé­”å…½ä¸–ç•Œâ€å§ï¼Ÿ - æ‰€éœ€è¦çš„ gas å¯èƒ½ä¼šä¹°åˆ°ä½ ç ´äº§ã€‚ä½†æ˜¯ä½ å¯ä»¥æ‰¾ä¸ªç®—æ³•ç†å¿µä¸åŒçš„ä¾§é“¾æ¥ç©å®ƒã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­å’±ä»¬ä¼šè®¨è®ºåˆ°ï¼Œä»€ä¹ˆæ ·çš„ DApp åº”è¯¥éƒ¨ç½²åœ¨å¤ªåŠä¸»é“¾ä¸Šï¼Œä»€ä¹ˆåˆæœ€å¥½æ”¾åœ¨ä¾§é“¾ã€‚

##### çœ gas çš„æ‹›æ•°ï¼šç»“æ„å°è£… ï¼ˆStruct packingï¼‰

åœ¨ç¬¬1è¯¾ä¸­ï¼Œæˆ‘ä»¬æåˆ°é™¤äº†åŸºæœ¬ç‰ˆçš„ `uint` å¤–ï¼Œè¿˜æœ‰å…¶ä»–å˜ç§ `uint`ï¼š`uint8`ï¼Œ`uint16`ï¼Œ`uint32`ç­‰ã€‚

é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šè€ƒè™‘ä½¿ç”¨ `uint` å˜ç§ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•å®šä¹‰ `uint`çš„å¤§å°ï¼ŒSolidity ä¸ºå®ƒä¿ç•™256ä½çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `uint8` è€Œä¸æ˜¯`uint`ï¼ˆ`uint256`ï¼‰ä¸ä¼šä¸ºä½ èŠ‚çœä»»ä½• gasã€‚

é™¤éï¼ŒæŠŠ `uint` ç»‘å®šåˆ° `struct` é‡Œé¢ã€‚

å¦‚æœä¸€ä¸ª `struct` ä¸­æœ‰å¤šä¸ª `uint`ï¼Œåˆ™å°½å¯èƒ½ä½¿ç”¨è¾ƒå°çš„ `uint`, Solidity ä¼šå°†è¿™äº› `uint` æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»è€Œå ç”¨è¾ƒå°‘çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼š

```
struct NormalStruct {
  uint a;
  uint b;
  uint c;
}

struct MiniMe {
  uint32 a;
  uint32 b;
  uint c;
}

// å› ä¸ºä½¿ç”¨äº†ç»“æ„æ‰“åŒ…ï¼Œ`mini` æ¯” `normal` å ç”¨çš„ç©ºé—´æ›´å°‘
NormalStruct normal = NormalStruct(10, 20, 30);
MiniMe mini = MiniMe(10, 20, 30); 
```

æ‰€ä»¥ï¼Œå½“ `uint` å®šä¹‰åœ¨ä¸€ä¸ª `struct` ä¸­çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨æœ€å°çš„æ•´æ•°å­ç±»å‹ä»¥èŠ‚çº¦ç©ºé—´ã€‚ å¹¶ä¸”æŠŠåŒæ ·ç±»å‹çš„å˜é‡æ”¾ä¸€èµ·ï¼ˆå³åœ¨ struct ä¸­å°†æŠŠå˜é‡æŒ‰ç…§ç±»å‹ä¾æ¬¡æ”¾ç½®ï¼‰ï¼Œè¿™æ · Solidity å¯ä»¥å°†å­˜å‚¨ç©ºé—´æœ€å°åŒ–ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ª `struct`ï¼š

```
uint c; uint32 a; uint32 b;` å’Œ `uint32 a; uint c; uint32 b;
```

å‰è€…æ¯”åè€…éœ€è¦çš„gasæ›´å°‘ï¼Œå› ä¸ºå‰è€…æŠŠ`uint32`æ”¾ä¸€èµ·äº†ã€‚

##### å®æˆ˜æ¼”ä¹ 

åœ¨æœ¬è¯¾ä¸­ï¼Œå’±ä»¬ç»™åƒµå°¸æ·»2ä¸ªæ–°åŠŸèƒ½ï¼š`level` å’Œ `readyTime` - åè€…æ˜¯ç”¨æ¥å®ç°ä¸€ä¸ªâ€œå†·å´å®šæ—¶å™¨â€ï¼Œä»¥é™åˆ¶åƒµå°¸çŒé£Ÿçš„é¢‘ç‡ã€‚

è®©æˆ‘ä»¬å›åˆ° `zombiefactory.sol`ã€‚

1. ä¸º `Zombie` ç»“æ„ä½“ æ·»åŠ ä¸¤ä¸ªå±æ€§ï¼š`level`ï¼ˆ`uint32`ï¼‰å’Œ`readyTime`ï¼ˆ`uint32`ï¼‰ã€‚å› ä¸ºå¸Œæœ›åŒç±»å‹æ•°æ®æ‰“æˆä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ç»“æ„ä½“çš„æœ«å°¾ã€‚

32ä½è¶³ä»¥ä¿å­˜åƒµå°¸çš„çº§åˆ«å’Œæ—¶é—´æˆ³äº†ï¼Œè¿™æ ·æ¯”èµ·ä½¿ç”¨æ™®é€šçš„`uint`ï¼ˆ256ä½ï¼‰ï¼Œå¯ä»¥æ›´ç´§å¯†åœ°å°è£…æ•°æ®ï¼Œä»è€Œä¸ºæˆ‘ä»¬çœç‚¹ gasã€‚

``` solidity
struct Zombie {
    string name;
    uint dna;
    uint32 level;
    uint32 readyTime;
}
```

